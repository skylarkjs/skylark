{"version":3,"sources":["css.js"],"names":["define","skylark","langx","construct","_createStyleSheet","link","document","createElement","id","count","rel","type","async","defer","head","appendChild","sheetElementsById","css","insertRuleFunc","getElementsByTagName","sheetsByUrl","defaultSheetId","defaultSheet","rulesPropName","deleteRuleFunc","deleteRule","removeRule","insertRule","_insertRule","selector","index","call","this","addRule","mixin","createStyleSheet","cssText","loadStyleSheet","url","loadedCallback","errorCallback","sheet","state","loadedCallbacks","errorCallbacks","push","node","onload","onerror","startTime","Date","getTime","callbacks","i","length","href","deleteSheetRule","sheetId","rule","isNumber","each","_rule","removeStyleSheet","Error","remove","findRules","rules","filters","parseSelector","$","styleSheets","styleSheet","filterStyleSheet","merge","_rules","filter","matchSelector","selectorText","map","normalizeRule","support","nativeCSSStyleRule","CSSStyleRule","reverse","insertSheetRule"],"mappings":"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","file":"../css.js","sourcesContent":["define([\r\n    \"./skylark\",\r\n    \"./langx\",\r\n    \"./noder\"\r\n], function(skylark, langx, construct) {\r\n\r\n    var head = document.getElementsByTagName(\"head\")[0],\r\n        count = 0,\r\n        sheetsByUrl = {},\r\n        sheetElementsById = {},\r\n        defaultSheetId = _createStyleSheet(),\r\n        defaultSheet = sheetElementsById[defaultSheetId],\r\n        rulesPropName = (\"cssRules\" in defaultSheet) ? \"cssRules\" : \"rules\",\r\n        insertRuleFunc,\r\n        deleteRuleFunc = defaultSheet.deleteRule || defaultSheet.removeRule;\r\n\r\n    if (defaultSheet.insertRule) {\r\n        var _insertRule = defaultSheet.insertRule;\r\n        insertRuleFunc = function(selector, css, index) {\r\n            _insertRule.call(this, selector + \"{\" + css + \"}\", index);\r\n        };\r\n    } else {\r\n        insertRuleFunc = defaultSheet.addRule;\r\n    }\r\n\r\n    function normalizeSelector(selectorText) {\r\n        var selector = [],\r\n            last, len;\r\n        last = defaultSheet[rulesPropName].length;\r\n        insertRuleFunc.call(defaultSheet, selectorText, ';');\r\n        len = defaultSheet[rulesPropName].length;\r\n        for (var i = len - 1; i >= last; i--) {\r\n            selector.push(_sheet[_rules][i].selectorText);\r\n            deleteRuleFunc.call(defaultSheet, i);\r\n        }\r\n        return selector.reverse().join(', ');\r\n    }\r\n\r\n    function _createStyleSheet() {\r\n        var link = document.createElement(\"link\"),\r\n            id = (count++);\r\n\r\n        link.rel = \"stylesheet\";\r\n        link.type = \"text/css\";\r\n        link.async = false;\r\n        link.defer = false;\r\n\r\n        head.appendChild(link);\r\n        sheetElementsById[id] = link;\r\n\r\n        return id;\r\n    }\r\n\r\n    function css() {\r\n        return css;\r\n    }\r\n\r\n    langx.mixin(css, {\r\n        createStyleSheet: function(cssText) {\r\n            return _createStyleSheet();\r\n        },\r\n\r\n        loadStyleSheet: function(url, loadedCallback, errorCallback) {\r\n            var sheet = sheetsByUrl[url];\r\n            if (!sheet) {\r\n                sheet = sheetsByUrl[url] = {\r\n                    state: 0, //0:unload,1:loaded,-1:loaderror\r\n                    loadedCallbacks: [],\r\n                    errorCallbacks: []\r\n                };\r\n            }\r\n\r\n            sheet.loadedCallbacks.push(loadedCallback);\r\n            sheet.errorCallbacks.push(errorCallback);\r\n\r\n            if (sheet.state === 1) {\r\n                sheet.node.onload();\r\n            } else if (sheet.state === -1) {\r\n                sheet.node.onerror();\r\n            } else {\r\n                sheet.id = _createStyleSheet();\r\n                var node = sheet.node = sheetElementsById[sheet.id];\r\n\r\n                startTime = new Date().getTime();\r\n\r\n                node.onload = function() {\r\n                    sheet.state = 1;\r\n                    sheet.state = -1;\r\n                    var callbacks = sheet.loadedCallbacks,\r\n                        i = callbacks.length;\r\n\r\n                    while (i--) {\r\n                        callbacks[i]();\r\n                    }\r\n                    sheet.loadedCallbacks = [];\r\n                    sheet.errorCallbacks = [];\r\n                },\r\n                node.onerror = function() {\r\n                    sheet.state = -1;\r\n                    var callbacks = sheet.errorCallbacks,\r\n                        i = callbacks.length;\r\n\r\n                    while (i--) {\r\n                        callbacks[i]();\r\n                    }\r\n                    sheet.loadedCallbacks = [];\r\n                    sheet.errorCallbacks = [];\r\n                };\r\n\r\n                node.href = sheet.url = url;\r\n\r\n                sheetsByUrl[node.url] = sheet;\r\n\r\n            }\r\n            return sheet.id;\r\n        },\r\n\r\n        deleteSheetRule: function(sheetId, rule) {\r\n            var sheet = sheetElementsById[sheetId];\r\n            if (langx.isNumber(rule)) {\r\n                deleteRuleFunc.call(sheet, rule);\r\n            } else {\r\n                langx.each(sheet[rulesPropName], function(i, _rule) {\r\n                    if (rule === _rule) {\r\n                        deleteRuleFunc.call(sheet, i);\r\n                        return false;\r\n                    }\r\n                });\r\n            }\r\n        },\r\n\r\n        deleteRule: function(rule) {\r\n            this.deleteSheetRule(defaultSheetId, rule);\r\n            return this;\r\n        },\r\n\r\n        removeStyleSheet: function(sheetId) {\r\n            if (sheetId === defaultSheetId) {\r\n                throw new Error(\"The default stylesheet can not be deleted\");\r\n            }\r\n            var sheet = sheetElementsById[sheetId];\r\n            delete sheetElementsById[sheetId];\r\n\r\n\r\n            construct.remove(sheet);\r\n            return this;\r\n        },\r\n\r\n        findRules: function(selector, sheetId) {\r\n            //return array of CSSStyleRule objects that match the selector text\r\n            var rules = [],\r\n                filters = parseSelector(selector);\r\n            $(document.styleSheets).each(function(i, styleSheet) {\r\n                if (filterStyleSheet(filters.styleSheet, styleSheet)) {\r\n                    $.merge(rules, $(styleSheet[_rules]).filter(function() {\r\n                        return matchSelector(this, filters.selectorText, filters.styleSheet === \"*\");\r\n                    }).map(function() {\r\n                        return normalizeRule($.support.nativeCSSStyleRule ? this : new CSSStyleRule(this), styleSheet);\r\n                    }));\r\n                }\r\n            });\r\n            return rules.reverse();\r\n        },\r\n\r\n        insertRule: function(selector, css, index) {\r\n            return this.insertSheetRule(defaultSheetId, selector, css, index);\r\n        },\r\n\r\n        insertSheetRule: function(sheetId, selector, css, index) {\r\n            if (!selector || !css) {\r\n                return -1;\r\n            }\r\n\r\n            var sheet = sheetElementsById[sheetId];\r\n            index = index || sheet[rulesPropName].length;\r\n\r\n            return insertRuleFunc.call(sheet, selector, css, index);\r\n\r\n        }\r\n    });\r\n\r\n    return skylark.css = css;\r\n});\r\n"]}