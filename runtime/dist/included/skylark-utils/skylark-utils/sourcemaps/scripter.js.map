{"version":3,"sources":["scripter.js"],"names":["define","skylark","langx","noder","finder","scripter","head","document","getElementsByTagName","scriptsByUrl","scriptElementsById","count","mixin","loadJavaScript","url","loadedCallback","errorCallback","script","state","loadedCallbacks","errorCallbacks","push","node","onload","onerror","createElement","id","type","async","defer","startTime","Date","getTime","appendChild","callbacks","i","length","src","deleteJavaScript","remove"],"mappings":";;;;;;;AAAAA,QACI,YACA,UACA,UACA,YACD,SAASC,EAASC,EAAOC,EAAOC,GAO/B,QAASC,KACL,MAAOA,GANX,GAAIC,GAAOC,SAASC,qBAAqB,QAAQ,GAC7CC,KACAC,KACAC,EAAQ,CA4EZ,OAtEAT,GAAMU,MAAMP,GAERQ,eAAgB,SAASC,EAAKC,EAAgBC,GAC1C,GAAIC,GAASR,EAAaK,EAY1B,IAXKG,IACDA,EAASR,EAAaK,IAClBI,MAAO,EACPC,mBACAC,oBAIRH,EAAOE,gBAAgBE,KAAKN,GAC5BE,EAAOG,eAAeC,KAAKL,GAEN,IAAjBC,EAAOC,MACPD,EAAOK,KAAKC,aACT,IAAIN,EAAOC,WACdD,EAAOK,KAAKE,cACT,CACH,GAAIF,GAAOL,EAAOK,KAAOf,SAASkB,cAAc,UAC5CC,EAAKT,EAAOS,GAAMf,GAEtBW,GAAKK,KAAO,kBACZL,EAAKM,OAAQ,EACbN,EAAKO,OAAQ,EACbC,WAAY,GAAIC,OAAOC,UACvB1B,EAAK2B,YAAYX,GAEjBA,EAAKC,OAAS,WACNN,EAAOC,MAAQ,CAKf,KAHA,GAAIgB,GAAYjB,EAAOE,gBACnBgB,EAAID,EAAUE,OAEXD,KACHD,EAAUC,IAEdlB,GAAOE,mBACPF,EAAOG,mBAEXE,EAAKE,QAAU,WACXP,EAAOC,QAIP,KAHA,GAAIgB,GAAYjB,EAAOG,eACnBe,EAAID,EAAUE,OAEXD,KACHD,EAAUC,IAEdlB,GAAOE,mBACPF,EAAOG,mBAEfE,EAAKe,IAAMvB,EAEXJ,EAAmBgB,GAAMJ,EAE7B,MAAOL,GAAOS,IAGlBY,iBAAkB,SAASZ,GACvB,GAAIJ,GAAOZ,EAAmBgB,EAC9B,IAAIJ,EAAM,CACN,GAAIR,GAAMQ,EAAKe,GACflC,GAAMoC,OAAOjB,SACNZ,GAAmBgB,SACnBjB,GAAaK,OAKzBb,EAAQI,SAAWA","file":"../scripter.js","sourcesContent":["define([\n    \"./skylark\",\n    \"./langx\",\n    \"./noder\",\n    \"./finder\"\n], function(skylark, langx, noder, finder) {\n\n    var head = document.getElementsByTagName('head')[0],\n        scriptsByUrl = {},\n        scriptElementsById = {},\n        count = 0;\n\n    function scripter() {\n        return scripter;\n    }\n\n    langx.mixin(scripter, {\n\n        loadJavaScript: function(url, loadedCallback, errorCallback) {\n            var script = scriptsByUrl[url];\n            if (!script) {\n                script = scriptsByUrl[url] = {\n                    state: 0, //0:unload,1:loaded,-1:loaderror\n                    loadedCallbacks: [],\n                    errorCallbacks: []\n                }\n            }\n\n            script.loadedCallbacks.push(loadedCallback);\n            script.errorCallbacks.push(errorCallback);\n\n            if (script.state === 1) {\n                script.node.onload();\n            } else if (script.state === -1) {\n                script.node.onerror();\n            } else {\n                var node = script.node = document.createElement(\"script\"),\n                    id = script.id = (count++);\n\n                node.type = \"text/javascript\";\n                node.async = false;\n                node.defer = false;\n                startTime = new Date().getTime();\n                head.appendChild(node);\n\n                node.onload = function() {\n                        script.state = 1;\n\n                        var callbacks = script.loadedCallbacks,\n                            i = callbacks.length;\n\n                        while (i--) {\n                            callbacks[i]();\n                        }\n                        script.loadedCallbacks = [];\n                        script.errorCallbacks = [];\n                    },\n                    node.onerror = function() {\n                        script.state = -1;\n                        var callbacks = script.errorCallbacks,\n                            i = callbacks.length;\n\n                        while (i--) {\n                            callbacks[i]();\n                        }\n                        script.loadedCallbacks = [];\n                        script.errorCallbacks = [];\n                    };\n                node.src = url;\n\n                scriptElementsById[id] = node;\n            }\n            return script.id;\n        },\n\n        deleteJavaScript: function(id) {\n            var node = scriptElementsById[id];\n            if (node) {\n                var url = node.src;\n                noder.remove(node);\n                delete scriptElementsById[id];\n                delete scriptsByUrl[url];\n            }\n        }\n    });\n\n    return skylark.scripter = scripter;\n});\n"]}