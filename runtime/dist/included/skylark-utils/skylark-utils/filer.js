/**
 * skylark-utils - An Elegant HTML5 JavaScript Library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./skylark","./langx","./datax","./eventer","./styler"],function(e,t,a,n,r){function i(e,a){a=a||{};var i=a.hoverClass||"dropzone",o=a.dropped,s=0;return p(e,"dragenter",function(t){t.dataTransfer&&t.dataTransfer.types.indexOf("Files")>-1&&(n.stop(t),s++,r.addClass(e,i))}),p(e,"dragover",function(e){e.dataTransfer&&e.dataTransfer.types.indexOf("Files")>-1&&n.stop(e)}),p(e,"dragleave",function(t){t.dataTransfer&&t.dataTransfer.types.indexOf("Files")>-1&&(s--,0==s&&r.removeClass(e,i))}),p(e,"drop",function(a){if(a.dataTransfer&&a.dataTransfer.types.indexOf("Files")>-1&&(r.removeClass(e,i),n.stop(a),o)){var s=a.dataTransfer.items;s&&s.length&&(s[0].webkitGetAsEntry||s[0].getAsEntry)?h.all(t.map(s,function(e){return e.webkitGetAsEntry?e.webkitGetAsEntry():e.getAsEntry()})).then(o):o(a.dataTransfer.files)}}),this}function o(e,a){a=a||{};var n=(a.hoverClass||"pastezone",a.pasted);return p(e,"paste",function(e){var a=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,r=[];a&&a.length&&t.each(a,function(e,t){var a=t.getAsFile&&t.getAsFile();a&&r.push(a)}),n&&r.length&&n(r)}),this}function s(e,t){return p(e,"click",function(e){e.preventDefault(),l(t)}),this}function l(e){function t(e){for(var t=e.length;t--;)e[t].size>m&&e.splice(t,1);r(e)}e=e||{};var a=e.directory||!1,n=e.multiple||!1,r=e.picked;if(!u){var i=u=document.createElement("input");i.type="file",i.style.position="fixed",i.style.left=0,i.style.top=0,i.style.opacity=.001,document.body.appendChild(i),i.onchange=function(e){var a=e.target.webkitEntries||e.target.entries;a&&a.length?h.all(a).then(function(e){t(e)}):t(Array.prototype.slice.call(e.target.files)),i.value=""}}u.multiple=n,u.webkitdirectory=a,u.click()}function d(e){function a(e){e.type=e.type||"POST",o(e,!0)||e.data||n(e)}function n(e){var a,n=e.files[0],r=e.multipart,i="array"===t.type(e.paramName)?e.paramName[0]:e.paramName;e.headers=t.mixin({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),r?(a=new FormData,e.blob?a.append(i,e.blob,n.name):t.each(e.files,function(n,r){a.append("array"===t.type(e.paramName)&&e.paramName[n]||i,r,r.uploadName||r.name)}),e.data=a):(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"',e.contentType=n.type||"application/octet-stream",e.data=e.blob||n),e.blob=null}function r(e){var t=e.getResponseHeader("Range"),a=t&&t.split("-"),n=a&&a.length>1&&parseInt(a[1],10);return n&&n+1}function i(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,a){var n=e-this.timestamp;return(!this.bitrate||!a||n>a)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}}function o(e,a){e.uploadedBytes=e.uploadedBytes||0;var i,o,s=e.files[0],d=s.size,u=e.uploadedBytes,c=e.maxChunkSize||d,p=l,m=new f,h=m.promise;return!(!p||!(u||c<d)||e.data)&&(!!a||(u>=d?(s.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",s.error])):(o=function(){var a=t.mixin({},e),l=a._progress.loaded;a.blob=p.call(s,u,u+c,s.type),a.chunkSize=a.blob.size,a.contentRange="bytes "+u+"-"+(u+a.chunkSize-1)+"/"+d,n(a),i=$.ajax(a).done(function(t,n,i){u=r(i)||u+a.chunkSize,l+a.chunkSize-a._progress.loaded&&m.progress({lengthComputable:!0,loaded:u-a.uploadedBytes,total:u-a.uploadedBytes}),e.uploadedBytes=a.uploadedBytes=u,a.result=t,a.textStatus=n,a.jqXHR=i,u<d?o():m.resolveWith(a.context,[t,n,i])}).fail(function(e,t,n){a.jqXHR=e,a.textStatus=t,a.errorThrown=n,m.rejectWith(a.context,[e,t,n])})},h.abort=function(){return i.abort()},o(),h)))}var s=t.mixin({contentRange:null,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,a){return e=this.messages[e]||e.toString(),a&&t.each(a,function(t,a){e=e.replace("{"+t+"}",a)}),e},formData:function(e){return e.serializeArray()},add:function(e,t){return!e.isDefaultPrevented()&&void((t.autoUpload||t.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()}))},processData:!1,contentType:!1,cache:!1},e),l=function(){var e=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;return e.apply(this,arguments)},d=function(e){return t.Xhr.request(e.url,e)};a(s),s._bitrateTimer=new i;var u=o(s)||d(s);return u.options=s,u}var u,c=Array.prototype.concat,p=n.on,f=(n.attr,t.Deferred),m=1/0,h=function(){function e(e,t){var n=new f,r=function(e){n.reject(e)};if(t=t||"",e.isFile)e.file(function(e){e.relativePath=t,n.resolve(e)},r);else if(e.isDirectory){var i=e.createReader();i.readEntries(function(i){a(i,t+e.name+"/").then(function(e){n.resolve(e)})["catch"](r)},r)}else n.resolve([]);return n.promise}function a(a,n){return f.all(t.map(a,function(t){return e(t,n)})).then(function(){return c.apply([],arguments)})}return{one:e,all:a}}(),v=function(){return v};return t.mixin(v,{dropzone:i,pastezone:o,picker:s,select:l,upload:d,readFile:function(e,t){t=t||{};var a=new f,n=new FileReader;return n.onload=function(e){a.resolve(e.target.result)},n.onerror=function(e){var t=e.target.error.code;2===t?alert("please don't open this page using protocol fill:///"):alert("error code: "+t)},t.asArrayBuffer?n.readAsArrayBuffer(e):t.asDataUrl?n.readAsDataURL(e):t.asText?n.readAsText(e):n.readAsArrayBuffer(e),a.promise},writeFile:function(e,a){if(window.navigator.msSaveBlob)t.isString(e)&&(e=dataURItoBlob(e)),window.navigator.msSaveBlob(e,a);else{var n=document.createElement("a");e instanceof Blob&&(e=t.URL.createObjectURL(e)),n.href=e,n.setAttribute("download",a||"noname"),n.dispatchEvent(new CustomEvent("click"))}}}),e.filer=v});
//# sourceMappingURL=sourcemaps/filer.js.map
