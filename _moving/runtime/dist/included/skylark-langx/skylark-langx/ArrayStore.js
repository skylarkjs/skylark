/**
 * skylark-langx - A simple JavaScript language extension library, including class support, Evented class, Deferred class and some commonly used tool functions.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./klass"],function(t){var r=function(t,r){function e(t,r,e){var n,i=0,a=t&&t.length||0,o=[];if(a&&"string"==typeof t&&(t=t.split("")),"string"==typeof r&&(r=cache[r]||buildFn(r)),e)for(;i<a;++i)n=t[i],r.call(e,n,i,t)&&o.push(n);else for(;i<a;++i)n=t[i],r(n,i,t)&&o.push(n);return o}function n(n){var i=e(n,t),a=r&&r.sort;if(a&&i.sort("function"==typeof a?a:function(t,r){for(var e,n=0;e=a[n];n++){var i=t[e.attribute],o=r[e.attribute];if(i=null!=i?i.valueOf():i,o=null!=o?o.valueOf():o,i!=o)return!!e.descending==(null==i||i>o)?-1:1}return 0}),r&&(r.start||r.count)){var o=i.length;i=i.slice(r.start||0,(r.start||0)+(r.count||1/0)),i.total=o}return i}switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var i=t;t=function(t){for(var r in i){var e=i[r];if(e&&e.test){if(!e.test(t[r],t))return!1}else if(e!=t[r])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}return n.matches=t,n},e=function(t){function r(r){t[r]=function(){var i=arguments,a=Deferred.when(t,function(t){return e(Array.prototype[r].apply(t,i))});if("forEach"!==r||n)return a}}if(!t)return t;var n=!!t.then;return n&&(t=Object.delegate(t)),r("forEach"),r("filter"),r("map"),null==t.total&&(t.total=Deferred.when(t,function(t){return t.length})),t},n=t({klassName:"ArrayStore",queryEngine:r,idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,r){var e=this.data,n=this.index,i=this.idProperty,a=t[i]=r&&"id"in r?r.id:i in t?t[i]:Math.random();if(a in n){if(r&&r.overwrite===!1)throw new Error("Object already exists");e[n[a]]=t}else n[a]=e.push(t)-1;return a},add:function(t,r){return(r=r||{}).overwrite=!1,this.put(t,r)},remove:function(t){var r=this.index,e=this.data;if(t in r)return e.splice(r[t],1),this.setData(e),!0},query:function(t,r){return e(this.queryEngine(t,r)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var r=0,e=t.length;r<e;r++)this.index[t[r][this.idProperty]]=r},init:function(t){for(var r in t)this[r]=t[r];this.setData(this.data||[])}});return n});
//# sourceMappingURL=sourcemaps/ArrayStore.js.map
