{"version":3,"sources":["Deferred.js"],"names":["define","arrays","funcs","objects","wrapPromise","p","d","added","state","isResolved","isRejected","then","onResolved","onRejected","onProgress","this","progress","mixin","Promise","prototype","call","args","undefined","__ctx__","apply","handler","PGLISTENERS","push","pipe","Symbol","slice","Array","proxy","makeArray","result","always","done","fail","Deferred","self","promise","resolve","reject","_resolve","_reject","value","arguments","resolveWith","context","_resolved","forEach","listener","error","reason","rejectWith","_rejected","callback","errback","progback","all","array","first","race","when","valueOrPromise","receivedPromise","nativePromise","length","deferred","cancel","err","data","immediate"],"mappings":"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","file":"../Deferred.js","sourcesContent":["define([\r\n    \"./arrays\",\r\n\t\"./funcs\",\r\n    \"./objects\"\r\n],function(arrays,funcs,objects){\r\n    \"use strict\";\r\n    \r\n    var  PGLISTENERS = Symbol ? Symbol() : '__pglisteners';\r\n\r\n    var slice = Array.prototype.slice,\r\n        proxy = funcs.proxy,\r\n        makeArray = arrays.makeArray,\r\n        result = objects.result,\r\n        mixin = objects.mixin;\r\n\r\n    mixin(Promise.prototype,{\r\n        always: function(handler) {\r\n            //this.done(handler);\r\n            //this.fail(handler);\r\n            this.then(handler,handler);\r\n            return this;\r\n        },\r\n        done : function(handler) {\r\n            this.then(handler);\r\n            return this;\r\n        },\r\n        fail : function(handler) { \r\n            //return mixin(Promise.prototype.catch.call(this,handler),added);\r\n            //return this.then(null,handler);\r\n            this.catch(handler);\r\n            return this;\r\n        }\r\n    });\r\n\r\n\r\n    var Deferred = function() {\r\n        var self = this,\r\n            p = this.promise = new Promise(function(resolve, reject) {\r\n                self._resolve = resolve;\r\n                self._reject = reject;\r\n            });\r\n\r\n        wrapPromise(p,self);\r\n\r\n        this[PGLISTENERS] = [];\r\n\r\n        //this.resolve = Deferred.prototype.resolve.bind(this);\r\n        //this.reject = Deferred.prototype.reject.bind(this);\r\n        //this.progress = Deferred.prototype.progress.bind(this);\r\n\r\n    };\r\n\r\n    function wrapPromise(p,d) {\r\n        var   added = {\r\n                state : function() {\r\n                    if (d.isResolved()) {\r\n                        return 'resolved';\r\n                    }\r\n                    if (d.isRejected()) {\r\n                        return 'rejected';\r\n                    }\r\n                    return 'pending';\r\n                },\r\n                then : function(onResolved,onRejected,onProgress) {\r\n                    if (onProgress) {\r\n                        this.progress(onProgress);\r\n                    }\r\n                    return mixin(Promise.prototype.then.call(this,\r\n                            onResolved && function(args) {\r\n                                if (args && args.__ctx__ !== undefined) {\r\n                                    return onResolved.apply(args.__ctx__,args);\r\n                                } else {\r\n                                    return onResolved(args);\r\n                                }\r\n                            },\r\n                            onRejected && function(args){\r\n                                if (args && args.__ctx__ !== undefined) {\r\n                                    return onRejected.apply(args.__ctx__,args);\r\n                                } else {\r\n                                    return onRejected(args);\r\n                                }\r\n                            }),added);\r\n                },\r\n                progress : function(handler) {\r\n                    d[PGLISTENERS].push(handler);\r\n                    return this;\r\n                }\r\n\r\n            };\r\n\r\n        added.pipe = added.then;\r\n        return mixin(p,added);\r\n\r\n    }\r\n\r\n    Deferred.prototype.resolve = function(value) {\r\n        var args = slice.call(arguments);\r\n        return this.resolveWith(null,args);\r\n    };\r\n\r\n    Deferred.prototype.resolveWith = function(context,args) {\r\n        args = args ? makeArray(args) : []; \r\n        args.__ctx__ = context;\r\n        this._resolve(args);\r\n        this._resolved = true;\r\n        return this;\r\n    };\r\n\r\n    Deferred.prototype.progress = function(value) {\r\n        try {\r\n          return this[PGLISTENERS].forEach(function (listener) {\r\n            return listener(value);\r\n          });\r\n        } catch (error) {\r\n          this.reject(error);\r\n        }\r\n        return this;\r\n    };\r\n\r\n    Deferred.prototype.reject = function(reason) {\r\n        var args = slice.call(arguments);\r\n        return this.rejectWith(null,args);\r\n    };\r\n\r\n    Deferred.prototype.rejectWith = function(context,args) {\r\n        args = args ? makeArray(args) : []; \r\n        args.__ctx__ = context;\r\n        this._reject(args);\r\n        this._rejected = true;\r\n        return this;\r\n    };\r\n\r\n    Deferred.prototype.isResolved = function() {\r\n        return !!this._resolved;\r\n    };\r\n\r\n    Deferred.prototype.isRejected = function() {\r\n        return !!this._rejected;\r\n    };\r\n\r\n    Deferred.prototype.then = function(callback, errback, progback) {\r\n        var p = result(this,\"promise\");\r\n        return p.then(callback, errback, progback);\r\n    };\r\n\r\n    Deferred.prototype.done  = Deferred.prototype.then;\r\n\r\n    Deferred.all = function(array) {\r\n        return wrapPromise(Promise.all(array));\r\n    };\r\n\r\n    Deferred.first = function(array) {\r\n        return wrapPromise(Promise.race(array));\r\n    };\r\n\r\n\r\n    Deferred.when = function(valueOrPromise, callback, errback, progback) {\r\n        var receivedPromise = valueOrPromise && typeof valueOrPromise.then === \"function\";\r\n        var nativePromise = receivedPromise && valueOrPromise instanceof Promise;\r\n\r\n        if (!receivedPromise) {\r\n            if (arguments.length > 1) {\r\n                return callback ? callback(valueOrPromise) : valueOrPromise;\r\n            } else {\r\n                return new Deferred().resolve(valueOrPromise);\r\n            }\r\n        } else if (!nativePromise) {\r\n            var deferred = new Deferred(valueOrPromise.cancel);\r\n            valueOrPromise.then(proxy(deferred.resolve,deferred), proxy(deferred.reject,deferred), deferred.progress);\r\n            valueOrPromise = deferred.promise;\r\n        }\r\n\r\n        if (callback || errback || progback) {\r\n            return valueOrPromise.then(callback, errback, progback);\r\n        }\r\n        return valueOrPromise;\r\n    };\r\n\r\n    Deferred.reject = function(err) {\r\n        var d = new Deferred();\r\n        d.reject(err);\r\n        return d.promise;\r\n    };\r\n\r\n    Deferred.resolve = function(data) {\r\n        var d = new Deferred();\r\n        d.resolve.apply(d,arguments);\r\n        return d.promise;\r\n    };\r\n\r\n    Deferred.immediate = Deferred.resolve;\r\n\r\n    return Deferred;\r\n})"]}