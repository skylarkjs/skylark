/**
 * skylark-spa - An Elegant  HTML5 Single Page Application Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){function n(t,e){if("."!==t[0])return t;var n=e.split("/"),r=t.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}var r=e.define,i=e.require,o="function"==typeof r&&r.amd,u=!o&&"undefined"!=typeof exports;if(!o&&!r){var a={};r=e.define=function(t,e,r){"function"==typeof r?(a[t]={factory:r,deps:e.map(function(e){return n(e,t)}),exports:null},i(t)):resolved[t]=r},i=e.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var e=a[t];if(!e.exports){var n=[];e.deps.forEach(function(t){n.push(i(t))}),e.exports=e.factory.apply(window,n)}return e.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(r,i),!o){var s=i("skylark-spa/main");u?exports=s:e.skylarkjs=s}}(function(t,e){t("skylark-langx/skylark",[],function(){var t={};return t}),t("skylark-langx/langx",["./skylark"],function(t){function e(t,e,n,r){var i,o=t[e],u="around"==e;if(u){var a=n(function(){return o.advice(this,arguments)});i={remove:function(){a&&(a=t=n=null)},advice:function(t,e){return a?a.apply(t,e):o.advice(t,e)}}}else i={remove:function(){if(i.advice){var r=i.previous,o=i.next;o||r?(r?r.next=o:t[e]=o,o&&(o.previous=r)):delete t[e],t=n=i.advice=null}},id:G++,advice:n,receiveArguments:r};if(o&&!u)if("after"==e){for(;o.next&&(o=o.next););o.next=i,i.previous=o}else"before"==e&&(t[e]=i,i.next=o,o.previous=i);else t[e]=i;return i}function n(t){return function(n,r,i,o){var u,a=n[r];a&&a.target==n||(n[r]=u=function(){for(var t=G,e=arguments,n=u.before;n;)e=n.advice.apply(this,e)||e,n=n.next;if(u.around)var r=u.around.advice(this,e);for(var i=u.after;i&&i.id<t;){if(i.receiveArguments){var o=i.advice.apply(this,e);r=o===B?r:o}else r=i.advice.call(this,r,e);i=i.next}return r},a&&(u.around={advice:function(t,e){return a.apply(t,e)}}),u.target=n);var s=e(u||a,t,i,o);return i=null,s}}function r(t,e){var n;if(t===B||null===t)n=t;else if(e&&t.clone)n=t.clone();else if(v(t)){n=[];for(var i=0;i<t.length;i++)n.push(r(t[i]))}else if(w(t)){n={};for(var o in t)n[o]=r(t[o])}else n=t;return n}function i(t,e){var n=new CustomEvent(t,e);return M(n,e)}function o(t,e){var n,r,i=function(){t.apply(null,r)};return function(){r=arguments,clearTimeout(n),n=setTimeout(i,e)}}function u(t){return Q.call(t,function(t){return null!=t})}function a(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function s(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(e){return t}}function c(t,e){var n,r,i,o,u;if(t)if(n=t.length,n===o){for(r in t)if(t.hasOwnProperty(r)&&(u=t[r],e.call(u,r,u)===!1))break}else for(i=0;i<n&&(u=t[i],e.call(u,i,u)!==!1);i++);return this}function f(t){if(d(t)){for(var e=[],n=0;n<t.length;n++){var r=t[n];if(d(r))for(var i=0;i<r.length;i++)e.push(r[i]);else e.push(r)}return e}return t}function l(t,e,n,r){return b(e)?e.call(t,n,r):e}function h(t){var t=t||window.location.href,e=t.split("?"),n={};return e.length>1&&e[1].split("&").forEach(function(t){var e=t.split("=");n[e[0]]=e[1]}),n}function p(t,e){if(!e)return-1;var n;if(e.indexOf)return e.indexOf(t);for(n=e.length;n--;)if(e[n]===t)return n;return-1}function v(t){return t&&t.constructor===Array}function d(t){return!x(t)&&!A(t)&&"number"==typeof t.length}function g(t){return"boolean"==typeof t}function y(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function m(t,e){return tt(t,e)}function b(t){return"function"==it(t)}function _(t){return"object"==it(t)}function w(t){return _(t)&&!k(t)&&Object.getPrototypeOf(t)==Object.prototype}function x(t){return"string"==typeof t}function k(t){return t&&t==t.window}function E(t){return"undefined"!=typeof t}function A(t){return t&&t instanceof Node}function j(t){return"number"==typeof t}function O(t){if(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t.startsWith(e)}}function S(t){var e;for(e in t)if(null!==t[e])return!1;return!0}function P(t,e,n){return d(t)?(n||[]).concat(Array.prototype.slice.call(t,e||0)):[t]}function C(t,e){var n,r,i,o=[];if(d(t))for(r=0;r<t.length;r++)n=e.call(t[r],t[r],r),null!=n&&o.push(n);else for(i in t)n=e.call(t[i],t[i],i),null!=n&&o.push(n);return f(o)}function N(t){return requestAnimationFrame(t),this}function R(t,e){var n=2 in arguments&&W.call(arguments,2);if(b(t)){var r=function(){return t.apply(e,n?n.concat(W.call(arguments)):arguments)};return r}if(x(e))return n?(n.unshift(t[e],t),R.apply(null,n)):R(t[e],t);throw new TypeError("expected function")}function T(t){return parseFloat(t)||0}function D(t){return null==t?"":String.prototype.trim.call(t)}function H(t,e){if(v(t)){var n=t.indexOf(e);n!=-1&&t.splice(n,1)}else if(w(t))for(var r in t)if(t[r]==e){delete t[r];break}return this}function U(t,e,n,r){for(var i in e)e.hasOwnProperty(i)&&(r&&t[i]!==B||(n&&(w(e[i])||v(e[i]))?(w(e[i])&&!w(t[i])&&(t[i]={}),v(e[i])&&!v(t[i])&&(t[i]=[]),U(t[i],e[i],n,r)):e[i]!==B&&(t[i]=e[i])));return t}function L(t){var e=W.call(arguments,0);return target=e.shift(),deep=!1,g(e[e.length-1])&&(deep=e.pop()),{target:target,sources:e,deep:deep}}function z(){var t=L.apply(this,arguments);return t.sources.forEach(function(e){U(t.target,e,t.deep,!1)}),t.target}function F(t,e,n){v(e)||(e=[e]);var r=e.length;if(!r)return b(n)?n.call(t):n;for(var i=0;i<r;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=n,i=r),t=b(o)?o.call(t):o}return t}function M(){var t=L.apply(this,arguments);return t.sources.forEach(function(e){U(t.target,e,t.deep,!0)}),t.target}function q(t,e,n,r){function i(t,e){if(t.match(/\./)){var n,r=function(t,e){var i=t.pop();return i?e[i]?r(t,n=e[i]):null:n};return r(t.split(".").reverse(),e)}return e[t]}return r=r||window,n=n?R(r,n):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,o,u){var a=i(o,e);return u&&(a=i(u,r).call(r,a,o)),n(a,o).toString()})}function $(t){return t._uid||(t._uid=ut++)}function V(t){return Q.call(t,function(e,n){return t.indexOf(e)==n})}function Z(t){var e=++at+"";return t?t+e:e}function I(){return I}var B,J={}.toString,W=(Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice),Q=Array.prototype.filter,G=0,K=function(){function t(t,e,n){var r=t.prototype,i=t.superclass.prototype,o=n&&n.noOverrided;for(var u in e)"constructor"!==u&&(r[u]="function"!=typeof e[u]||e[u]._constructor||o||"function"!=typeof i[u]?e[u]:function(t,e,n){return function(){var t=this.overrided;this.overrided=n;var r=e.apply(this,arguments);return this.overrided=t,r}}(u,e[u],i[u]));return t}return function e(n,r,i){var o=n.constructor;o===Object&&(o=function(){this.init&&this.init.apply(this,arguments)});var u=n.klassName||"",a=new Function("return function "+u+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}ctor._constructor.apply(inst, arguments);return inst;}")();return a._constructor=o,r=r||Object,a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.superclass=r,a.__proto__=r,a.partial||(a.partial=function(e,n){return t(this,e,n)}),a.inherit||(a.inherit=function(t,n){return e(t,this,n)}),a.partial(n,i),a}}(),X=function(){function t(){}return function(e,n){t.prototype=e;var r=new t;return t.prototype=null,n&&z(r,n),r}}(),Y=function(){this.promise=new Promise(function(t,e){this._resolve=t,this._reject=e}.bind(this)),this.resolve=Y.prototype.resolve.bind(this),this.reject=Y.prototype.reject.bind(this)};Y.prototype.resolve=function(t){return this._resolve.call(this.promise,t),this},Y.prototype.reject=function(t){return this._reject.call(this.promise,t),this},Y.prototype.then=function(t,e,n){return this.promise.then(t,e,n)},Y.all=function(t){return Promise.all(t)},Y.first=function(t){return Promise.race(t)},Y.when=function(t,e,n,r){var i=t&&"function"==typeof t.then,o=i&&t instanceof Promise;if(!i)return arguments.length>1?e?e(t):t:(new Y).resolve(t);if(!o){var u=new Y(t.cancel);t.then(u.resolve,u.reject,u.progress),t=u.promise}return e||n||r?t.then(e,n,r):t},Y.reject=function(t){var e=new Y;return e.reject(t),e.promise},Y.resolve=function(t){var e=new Y;return e.resolve(t),e.promise},Y.immediate=Y.resolve;var tt,et,nt=K({on:function(t,e,n,r,i,o){var u=this,a=this._hub||(this._hub={});return w(t)?(i=r,c(t,function(t,r){u.on(t,e,n,r,i,o)}),this):(x(e)||b(r)||(i=r,r=n,n=e,e=B),b(n)&&(i=r,r=n,n=null),x(t)&&(t=t.split(/\s/)),t.forEach(function(t){(a[t]||(a[t]=[])).push({fn:r,selector:e,data:n,ctx:i,one:o})}),this)},one:function(t,e,n,r,i){return this.on(t,e,n,r,i,1)},trigger:function(t){if(!this._hub)return this;var e=this;x(t)&&(t=new CustomEvent(t)),t.target=this;var n=W.call(arguments,1);return n=E(n)?[t].concat(n):[t],[t.type||t.name,"all"].forEach(function(r){var i=e._hub[r];if(i){for(var o=i.length,a=!1,s=0;s<o;s++){var c=i[s];t.data?c.data&&(t.data=z({},c.data,t.data)):t.data=c.data||null,c.fn.apply(c.ctx,n),c.one&&(i[s]=null,a=!0)}a&&(e._hub[r]=u(i))}}),this},listened:function(t){var e=(this._hub||(this._events={}))[t]||[];return e.length>0},listenTo:function(t,e,n,r){if(!t)return this;x(n)&&(n=this[n]),r?t.one(e,n,this):t.on(e,n,this);for(var i,o=this._listeningTo||(this._listeningTo=[]),u=0;u<o.length;u++)if(o[u].obj==t){i=o[u];break}i||o.push(i={obj:t,events:{}});var a=i.events,s=a[e]=a[e]||[];return s.indexOf(n)==-1&&s.push(n),this},listenToOnce:function(t,e,n){return this.listenTo(t,e,n,1)},off:function(t,e){var n=this._hub||(this._hub={});return x(t)&&(t=t.split(/\s/)),t.forEach(function(t){var r=n[t],i=[];if(r&&e)for(var o=0,u=r.length;o<u;o++)r[o].fn!==e&&r[o].fn._!==e&&i.push(r[o]);i.length?n[t]=i:delete n[t]}),this},unlistenTo:function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var i=0;i<r.length;i++){var o=r[i];if(!t||t==o.obj){var a=o.events;for(var s in a)if(!e||e==s){listeningEvent=a[s];for(var c=0;c<listeningEvent.length;c++)n&&n!=listeningEvent[i]||(o.obj.off(s,listeningEvent[i],this),listeningEvent[i]=null);listeningEvent=a[s]=u(listeningEvent),S(listeningEvent)&&(a[s]=null)}S(a)&&(r[i]=null)}}return r=this._listeningTo=u(r),S(r)&&(this._listeningTo=null),this}}),rt=(function(){var t;return function(e){return t||(t=document.createElement("a")),t.href=e,t.href}}(),"undefined"!=typeof Symbol?Symbol.prototype:null);tt=function(t,e,n,r){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return!1;if(t!==t)return e!==e;var i=typeof t;return("function"===i||"object"===i||"object"==typeof e)&&et(t,e,n,r)},et=function(t,e,n,r){var i=J.call(t);if(i!==J.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e;case"[object Symbol]":return rt.valueOf.call(t)===rt.valueOf.call(e)}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var u=t.constructor,a=e.constructor;if(u!==a&&!(b(u)&&u instanceof u&&b(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],r=r||[];for(var s=n.length;s--;)if(n[s]===t)return r[s]===e;if(n.push(t),r.push(e),o){if(s=t.length,s!==e.length)return!1;for(;s--;)if(!tt(t[s],e[s],n,r))return!1}else{var c,f=Object.keys(t);if(s=f.length,Object.keys(e).length!==s)return!1;for(;s--;)if(c=f[s],e[c]===B||!tt(t[c],e[c],n,r))return!1}return n.pop(),r.pop(),!0};var it=function(){var t={};return c("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,n){t["[object "+n+"]"]=n.toLowerCase()}),function(e){return null==e?String(e):t[J.call(e)]||"object"}}(),ot=nt.inherit({init:function(t,e){var n=t||{};e||(e={}),this.cid=Z(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var r=F(this,"defaults");n=z({},r,n),this.set(n,e),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(t){return r(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return null!=this.get(t)},set:function(t,e,n){if(null==t)return this;var i;if("object"==typeof t?(i=t,n=e):(i={})[t]=e,n||(n={}),!this._validate(i,n))return!1;var o=n.unset,u=n.silent,a=[],s=this._changing;this._changing=!0,s||(this._previousAttributes=r(this.attributes),this.changed={});var c=this.attributes,f=this.changed,l=this._previousAttributes;for(var h in i)e=i[h],m(c[h],e)||a.push(h),m(l[h],e)?delete f[h]:f[h]=e,o?delete c[h]:c[h]=e;if(this.idAttribute in i&&(this.id=this.get(this.idAttribute)),!u){a.length&&(this._pending=n);for(var p=0;p<a.length;p++)this.trigger("change:"+a[p],this,c[a[p]],n)}if(s)return this;if(!u)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,z({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,z({},t,{unset:!0}))},hasChanged:function(t){return null==t?!S(this.changed):this.changed[t]!==B},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&r(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var i in t){var o=t[i];m(e[i],o)||(n[i]=o)}return!S(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return r(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},z({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=z({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,z(e,{validationError:n})),!1)}}),ut=1,at=0;return z(I,{after:n("after"),around:n("around"),before:n("before"),camelCase:function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})},clone:r,compact:u,createEvent:i,dasherize:a,debounce:o,delegate:X,Deferred:Y,Evented:nt,deserializeValue:s,each:c,flatten:f,funcArg:l,getQueryParams:h,inArray:p,isArray:v,isArrayLike:d,isBoolean:g,isDefined:function(t){return t!==B},isDocument:y,isEmptyObject:S,isEqual:m,isFunction:b,isHtmlNode:A,isObject:_,isPlainObject:w,isNumber:j,isString:x,isSameOrigin:O,isWindow:k,klass:function(t,e,n){return K(t,e,n)},lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},makeArray:P,map:C,mixin:z,nextTick:N,proxy:R,removeItem:H,result:F,returnTrue:function(){return!0},returnFalse:function(){return!1},safeMixin:M,serializeValue:function(t){return JSON.stringify(t)},Stateful:ot,substitute:q,toPixel:T,trim:D,type:it,uid:$,uniq:V,uniqueId:Z,upperFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},URL:window.URL||window.webkitURL}),t.langx=I}),t("skylark-router/router",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){function n(t,n){var r=new CustomEvent(t,n);return e.safeMixin(r,n)}function r(){return d}function i(t){if(d){var r=d.route.exit({path:d.path,params:d.params},!0);if(!r)return}if(g=d,d=t,!d.route){var i=u(d.path);d.route=i.route,d.params=i.params}var o=d.route.enter({force:d.force,path:d.path,params:d.params},!0);e.Deferred.when(o).then(function(){w.trigger(n("routing",{current:d,previous:g})),d.route.enter({path:d.path,params:d.params},!1),g&&g.route.exit({path:g.path,params:g.params},!1),w.trigger(n("routed",{current:d,previous:g}))})}function o(t,e){if(!e&&d&&d.path==t)return!1;var r=u(t);if(r)if(r.path=t,k.useHistoryApi){var o={force:e,path:t};window.history.pushState(o,document.title,(y+t).replace("//","/")),window.dispatchEvent(n("popstate",{state:o}))}else if(k.useHashbang){var a="#!"+t;window.location.hash!==a?window.location.hash=a:i(r)}else i(r);return!0}function u(t,n){var r=!1;return!n&&(r=_[t])?r:(e.each(b,function(e,n){var i=n.match(t);return!i||(r={route:n,params:i},!1)}),r&&!n&&(_[t]=r),r)}function a(t,e){var n,r=b[t];return r&&(n=r.path(e)),n}function s(){return g}function c(t){return e.isDefined(t)?(y=t,this):y}function f(){return w}function l(t){return e.isDefined(t)?(m=t,this):m}function h(t,n){if(e.isDefined(n)){var r={};return r[t]=n,p(r),this}return b[t]}function p(t){if(!e.isDefined(t))return e.mixin({},b);for(var n in t)b[n]=new k.Route(n,t[n])}function v(){null==k.useHashbang&&null==k.useHistoryApi&&(window.location.host&&window.history.pushState?k.useHistoryApi=!0:k.useHashbang=!0);var t="";k.useHistoryApi?(t=window.location.pathname,void 0===y&&(y=t.replace(/\/$/,"")),t=t.replace(y,"")||m||"/"):t=k.useHashbang?window.location.hash.replace("#!","")||m||"/":"/",t.startsWith("/")||(t="/"+t),k.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&i(t.state),t.preventDefault()}):k.useHashbang&&window.addEventListener("hashchange",function(t){i({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()}),o(t)}var d,g,y,m,b={},_={},w=new e.Evented,x=e.Evented.inherit({klassName:"Route",init:function(t,n){n=e.mixin({},n);var r=n.pathto||"",i=r,o=i.match(/\:([a-zA-Z0-9_]+)/g);null!==o?(o=o.map(function(t){return t.substring(1)}),i=i.replace(/\:([a-zA-Z0-9_]+)/g,"(.*?)")):o=[],i="*"===i?"(.*)":i.replace("/","\\/"),this._setting=n,this.name=t,this.pathto=r,this.paramNames=o,this.params=i,this.regex=new RegExp("^"+i+"$","");var u=this;["entering","entered","exiting","exited"].forEach(function(t){e.isFunction(n[t])&&u.on(t,n[t])})},enter:function(t,r){if(r){var i=this._entering(t),o=this;return e.Deferred.when(i).then(function(){var t=n("entering",{route:o,result:!0});return o.trigger(t),t.result})}return this._entered(t),this.trigger(n("entered",e.safeMixin({route:this},t))),this},exit:function(t,r){if(r){var i=this._exiting(t);if(!i)return!1;var o=n("exiting",{route:this,result:!0});return this.trigger(o),o.result}return this._exited(t),this.trigger(n("exited",e.safeMixin({route:this},t))),this},match:function(t){var e=this.paramNames,n=t.indexOf("?"),t=~n?t.slice(0,n):decodeURIComponent(t),r=this.regex.exec(t);if(!r)return!1;for(var i={},o=1,u=r.length;o<u;++o){var a=e[o-1],s=decodeURIComponent(r[o]);i[a]=s}return i},path:function(t){var e=this.pathto;return t&&(e=e.replace(/:([a-zA-Z0-9_]+)/g,function(e,n){return t[n]})),e},_entering:function(t){return!0},_entered:function(t){return!0},_exiting:function(t){return!0},_exited:function(t){return!0}}),k=function(){return k};return e.mixin(k,{Route:x,current:r,go:o,map:u,hub:f,off:function(){w.off.apply(w,arguments)},on:function(){w.on.apply(w,arguments)},one:function(){w.one.apply(w,arguments)},path:a,previous:s,baseUrl:c,homePath:l,route:h,routes:p,start:v,trigger:function(t){return w.trigger(t),this},useHistoryApi:null,useHashbang:null}),t.router=k}),t("skylark-router",["skylark-router/router"],function(t){return t}),t("skylark-spa/spa",["skylark-langx/skylark","skylark-langx/langx","skylark-router/router"],function(t,n,r){function i(t,e){var r=new CustomEvent(t,e);return n.safeMixin(r,e)}var o,u=n.Deferred,a=r.Route=r.Route.inherit({klassName:"SpaRoute",init:function(t,e){this.overrided(t,e),this.content=e.content,this.forceRefresh=e.forceRefresh,this.data=e.data;var r=this;["preparing","rendering","rendered"].forEach(function(t){n.isFunction(e[t])&&r.on(t,e[t])})},_entering:function(t){return this.forceRefresh||t.force||!this._prepared?this.prepare():this},getConfigData:function(t){return t?this.data[t]:this.data},getNamedValue:function(){return window.location.pathname.match(this.regex)},prepare:function(){var t=new u,n=this._setting,r=n.controller,o=this.controller,a=this;n.content,n.contentPath;return e([r.type],function(e){o=a.controller=new e(r),t.resolve()}),t.then(function(){var t=i("preparing",{route:a,result:!0});return a.trigger(t),u.when(t.result).then(function(){a._prepared=!0})})},render:function(t){var e=i("rendering",{route:this,context:t,content:this.content});return this.trigger(e),e.content},trigger:function(t){var e=this.controller;return e?e.perform(t):this.overrided(t)}}),s=n.Evented.inherit({klassName:"SpaRouteController",init:function(t,e){e=e||{},this.content=e.content,this.data=e.data},getConfigData:function(t){return t?this.data[t]:this.data},perform:function(t){var e=t.type;if(this[e])return this[e].call(this,t)}}),c=n.Evented.inherit({klassName:"SpaPage",init:function(t){t=n.mixin({routeViewer:"body"},t),this._params=t,this._rvc=document.querySelector(t.routeViewer),this._router=r,r.on("routed",n.proxy(this,"refresh"))},prepare:function(){},refresh:function(){var t=r.current(),e=(r.previous(),t.route.render(t));void 0!==e&&null!==e&&(n.isString(e)?this._rvc.innerHTML=e:(this._rvc.innerHTML="",this._rvc.appendChild(e)),t.route.trigger(i("rendered",{route:t.route,content:e})))}}),f=n.Evented.inherit({klassName:"SpaPlugin",init:function(t,e){this.name=t,n.isString(e.hookers)&&(e.hookers=e.hookers.split(" ")),this._setting=e},isHooked:function(t){var e=this._setting.hookers||[];return e.indexOf(t)>-1},prepare:function(){var t=new u,o=this._setting,a=o.controller,s=this.controller,c=this;return e([a.type],function(e){s=c.controller=new e(a),r.on(o.hookers,{plugin:c},n.proxy(s.perform,s)),t.resolve()}),t.then(function(){var t=i("preparing",{plugin:c,result:!0});return c.trigger(t),u.when(t.result).then(function(){c._prepared=!0})})},trigger:function(t){var e=this.controller;return e?e.perform(t):this.overrided(t)}}),l=n.Evented.inherit({klassName:"SpaPluginController",init:function(t){this.plugin=t},perform:function(t){var e=t.type;if(this[e])return this[e].call(this,t)}}),h=n.Evented.inherit({klassName:"SpaApplication",init:function(t){if(o)return o;var e=this._plugins={};t=this._config=n.mixin({plugins:{}},t,!0),n.each(t.plugins,function(t,n){e[t]=new f(t,n)}),r.routes(t.routes),this._router=r,this._page=new p.Page(t.page),document.title=t.title;var i=t.baseUrl;void 0===i&&(i=t.baseUrl=new n.URL(document.baseURI).pathname),r.baseUrl(i),t.homePath&&r.homePath(t.homePath),o=this},getConfig:function(t){return t?this._config[t]:this._config},go:function(t,e){return r.go(t,e),this},page:function(){return this._page},prepare:function(){if(this._prepared)return u.resolve();var t=this,e=n.map(this._plugins,function(t,e){if(t.isHooked("starting"))return t.prepare()});return u.all(e).then(function(){r.trigger(i("starting",{spa:t}));var e=n.map(r.routes(),function(t,e){if(t.lazy===!1)return t.prepare()}),o=n.map(t._plugins,function(t,e){if(!t.isHooked("starting"))return t.prepare()});return u.all(e.concat(o)).then(function(){t._prepared=!0})})},run:function(){this._router.start(),r.trigger(i("started",{spa:this}))}}),p=function(t){return o||(window[t.name||"app"]=o=new p.Application(t)),o};return n.mixin(p,{Application:h,Page:c,Plugin:f,PluginController:l,Route:a,RouteController:s}),t.spa=p}),t("skylark-spa/main",["skylark-langx/skylark","./spa"],function(t){return t}),t("skylark-spa",["skylark-spa/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-spa-all.js.map
