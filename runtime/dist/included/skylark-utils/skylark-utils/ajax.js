/**
 * skylark-utils - An Elegant HTML5 JavaScript Library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./skylark","./langx","./noder","./styler","./geom","./eventer","./query"],function(t,e,n,r,i,o,a){function s(t){var n=[["resolve","done",C({once:1,memory:1}),"resolved"],["reject","fail",C({once:1,memory:1}),"rejected"],["notify","progress",C({memory:1})]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var t=arguments;return s(function(r){e.each(n,function(n,a){var s=$.isFunction(t[n])&&t[n];o[a[1]](function(){var t=s&&s.apply(this,arguments);if(t&&e.isFunction(t.promise))t.promise().done(r.resolve).fail(r.reject).progress(r.notify);else{var n=this===i?r.promise():this,o=s?[t]:arguments;r[a[0]+"With"](n,o)}})}),t=null}).promise()},promise:function(t){return null!=t?e.mixin(t,i):i}},o={};return e.each(n,function(t,e){var a=e[2],s=e[3];i[e[1]]=a.add,s&&a.add(function(){r=s},n[1^t][2].disable,n[2][2].lock),o[e[0]]=function(){return o[e[0]+"With"](this===o?i:this,arguments),this},o[e[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o}function c(t,e,n){var r=o.create(e);return $(t).trigger(r,n),!r.isDefaultPrevented()}function u(t,e,n,r){if(t.global)return c(e||E,n,r)}function l(t){t.global&&0===X++&&u(t,null,"ajaxStart")}function p(t){t.global&&!--X&&u(t,null,"ajaxStop")}function f(t,e){var n=e.context;return e.beforeSend.call(n,t,e)!==!1&&u(e,n,"ajaxBeforeSend",[t,e])!==!1&&void u(e,n,"ajaxSend",[t,e])}function d(t,e,n,r){var i=n.context,o="success";n.success.call(i,t,o,e),r&&r.resolveWith(i,[t,o,e]),u(n,i,"ajaxSuccess",[e,n,t]),m(o,e,n)}function h(t,e,n,r,i){var o=r.context;r.error.call(o,n,e,t),i&&i.rejectWith(o,[n,e,t]),u(r,o,"ajaxError",[n,r,t||e]),m(e,n,r)}function m(t,e,n){var r=n.context;n.complete.call(r,e,t),u(n,r,"ajaxComplete",[e,n]),p(n)}function y(){}function v(t){return t&&(t=t.split(";",2)[0]),t&&(t==L?"html":t==H?"json":R.test(t)?"script":q.test(t)&&"xml")||"text"}function x(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function g(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=I(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=x(t.url,t.data),t.data=void 0)}function j(t){var n,r=e.mixin({},t||{}),i=s();for(F in J)void 0===r[F]&&(r[F]=J[F]);l(r),r.crossDomain||(n=E.createElement("a"),n.href=r.url,n.href=n.href,r.crossDomain=P.protocol+"//"+P.host!=n.protocol+"//"+n.host),r.url||(r.url=window.location.toString()),g(r);var o=r.dataType,a=/\?.+=\?/.test(r.url);if(a&&(o="jsonp"),r.cache!==!1&&(t&&t.cache===!0||"script"!=o&&"jsonp"!=o)||(r.url=x(r.url,"_="+Date.now())),"jsonp"==o)return a||(r.url=x(r.url,r.jsonp?r.jsonp+"=?":r.jsonp===!1?"":"callback=?")),G(r,i);var c,u=r.accepts[o],p={},m=function(t,e){p[t.toLowerCase()]=[t,e]},j=/^([\w-]+:)\/\//.test(r.url)?RegExp.$1:window.location.protocol,w=r.xhr(),b=w.setRequestHeader;if(i&&i.promise(w),r.crossDomain||m("X-Requested-With","XMLHttpRequest"),m("Accept",u||"*/*"),(u=r.mimeType||u)&&(u.indexOf(",")>-1&&(u=u.split(",",2)[0]),w.overrideMimeType&&w.overrideMimeType(u)),(r.contentType||r.contentType!==!1&&r.data&&"GET"!=r.type.toUpperCase())&&m("Content-Type",r.contentType||"application/x-www-form-urlencoded"),r.headers)for(W in r.headers)m(W,r.headers[W]);if(w.setRequestHeader=m,w.onreadystatechange=function(){if(4==w.readyState){w.onreadystatechange=y,clearTimeout(c);var t,e=!1;if(w.status>=200&&w.status<300||304==w.status||0==w.status&&"file:"==j){o=o||v(r.mimeType||w.getResponseHeader("content-type")),t=w.responseText;try{"script"==o?(0,eval)(t):"xml"==o?t=w.responseXML:"json"==o&&(t=M.test(t)?null:JSON.parse(t))}catch(n){e=n}e?h(e,"parsererror",w,r,i):d(t,w,r,i)}else h(w.statusText||null,w.status?"error":"abort",w,r,i)}},f(w,r)===!1)return w.abort(),h(null,"abort",w,r,i),w;if(r.xhrFields)for(W in r.xhrFields)w[W]=r.xhrFields[W];var T=!("async"in r)||r.async;w.open(r.type,r.url,T,r.username,r.password);for(W in p)b.apply(w,p[W]);return r.timeout>0&&(c=setTimeout(function(){w.onreadystatechange=y,w.abort(),h(null,"timeout",w,r,i)},r.timeout)),w.send(r.data?r.data:null),w}function w(t,n,r,i){return e.isFunction(n)&&(i=r,r=n,n=void 0),e.isFunction(r)||(i=r,r=void 0),{url:t,data:n,success:r,dataType:i}}function b(t,n,r,i){var o,a=e.isArray(n),s=e.isPlainObject(n);e.each(n,function(n,c){o=e.type(c),i&&(n=r?i:i+"["+(s||"object"==o||"array"==o?n:"")+"]"),!i&&a?t.add(c.name,c.value):"array"==o||!r&&"object"==o?b(t,c,r,n):t.add(n,c)})}function T(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var r,i=0,o=e.toLowerCase().match(K)||[];if(jQuery.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(t[r]=t[r]||[]).unshift(n)):(t[r]=t[r]||[]).push(n)}}function S(t,e){var n,r,i=J.flatOptions||{};for(n in e)void 0!==e[n]&&((i[n]?t:r||(r={}))[n]=e[n]);return r&&jQuery.extend(!0,t,r),t}var F,W,C=function(t){t=e.mixin({},t);var n,r,i,o,a,s,c=[],u=!t.once&&[],l=function(e){for(n=t.memory&&e,r=!0,s=o||0,o=0,a=c.length,i=!0;c&&s<a;++s)if(c[s].apply(e[0],e[1])===!1&&t.stopOnFalse){n=!1;break}i=!1,c&&(u?u.length&&l(u.shift()):n?c.length=0:p.disable())},p={add:function(){if(c){var r=c.length,s=function(n){e.each(n,function(e,n){"function"==typeof n?t.unique&&p.has(n)||c.push(n):n&&n.length&&"string"!=typeof n&&s(n)})};s(arguments),i?a=c.length:n&&(o=r,l(n))}return this},remove:function(){return c&&e.each(arguments,function(t,n){for(var r;(r=e.inArray(n,c,r))>-1;)c.splice(r,1),i&&(r<=a&&--a,r<=s&&--s)}),this},has:function(t){return!(!c||!(t?e.inArray(t,c)>-1:c.length))},empty:function(){return a=c.length=0,this},disable:function(){return c=u=n=void 0,this},disabled:function(){return!c},lock:function(){return u=void 0,n||p.disable(),this},locked:function(){return!u},fireWith:function(t,e){return!c||r&&!u||(e=e||[],e=[t,e.slice?e.slice():e],i?u.push(e):l(e)),this},fire:function(){return p.fireWith(this,arguments)},fired:function(){return!!r}};return p},k=Array.prototype.slice,D=function(t){var n,r,i,o=k.call(arguments),a=o.length,c=0,u=1!==a||t&&e.isFunction(t.promise)?a:0,l=1===u?t:s(),p=function(t,e,r){return function(i){e[t]=this,r[t]=arguments.length>1?k.call(arguments):i,r===n?l.notifyWith(e,r):--u||l.resolveWith(e,r)}};if(a>1)for(n=new Array(a),r=new Array(a),i=new Array(a);c<a;++c)o[c]&&e.isFunction(o[c].promise)?o[c].promise().done(p(c,i,o)).fail(l.reject).progress(p(c,r,n)):--u;return u||l.resolveWith(i,o),l.promise()},A=0,E=window.document,O=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,R=/^(?:text|application)\/javascript/i,q=/^(?:text|application)\/xml/i,H="application/json",L="text/html",M=/^\s*$/,P=E.createElement("a");P.href=window.location.href;var X=0,G=function(t,n){if(!("type"in t))return j(t);var r,i,o=t.jsonpCallback,a=(e.isFunction(o)?o():o)||"jsonp"+ ++A,s=E.createElement("script"),c=window[a],u=function(t){$(s).triggerHandler("error",t||"abort")},l={abort:u};return n&&n.promise(l),$(s).on("load error",function(o,u){clearTimeout(i),$(s).off().remove(),"error"!=o.type&&r?d(r[0],l,t,n):h(null,u||"error",l,t,n),window[a]=c,r&&e.isFunction(c)&&c(r[0]),c=r=void 0}),f(l,t)===!1?(u("abort"),l):(window[a]=function(){r=arguments},s.src=t.url.replace(/\?(.+)=\?/,"?$1="+a),E.head.appendChild(s),t.timeout>0&&(i=setTimeout(function(){u("timeout")},t.timeout)),l)},J={type:"GET",beforeSend:y,success:y,error:y,complete:y,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:H,xml:"application/xml, text/xml",html:L,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},N=function(){return j(w.apply(null,arguments))},U=function(){var t=w.apply(null,arguments);return t.type="POST",j(t)},Q=function(){var t=w.apply(null,arguments);return t.dataType="json",j(t)};a.fn.load=function(t,e,n){if(!this.length)return this;var r,i=this,o=t.split(/\s/),a=w(t,e,n),s=a.success;return o.length>1&&(a.url=o[0],r=o[1]),a.success=function(t){i.html(r?$("<div>").html(t.replace(O,"")).find(r):t),s&&s.apply(i,arguments)},j(a),this};var B=encodeURIComponent,I=function(t,n){var r=[];return r.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(B(t)+"="+B(n))},b(r,t,n),r.join("&").replace(/%20/g,"+")},_={},z={},K=/\S+/g,V=T(_),Y=T(z),Z=function(t,e){return e?S(S(t,J),e):S(J,t)};return e.mixin(j,{ajaxJSONP:G,ajaxPrefilter:V,ajaxTransport:Y,ajaxSettings:J,ajaxSetup:Z,Callbacks:C,Deferred:s,get:N,getJSON:Q,param:I,post:U,when:D}),t.ajax=j});
//# sourceMappingURL=sourcemaps/ajax.js.map
