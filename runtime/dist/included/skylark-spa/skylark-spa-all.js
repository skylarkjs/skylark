/**
 * skylark-spa - An Elegant  HTML5 Single Page Application Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.5-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,r){function e(t,r){if("."!==t[0])return t;var e=r.split("/"),n=t.split("/");e.pop();for(var i=0;i<n.length;i++)"."!=n[i]&&(".."==n[i]?e.pop():e.push(n[i]));return e.join("/")}var n=r.define,i=r.require,o="function"==typeof n&&n.amd,u=!o&&"undefined"!=typeof exports;if(!o&&!n){var a={};n=r.define=function(t,r,n){"function"==typeof n?(a[t]={factory:n,deps:r.map(function(r){return e(r,t)}),exports:null},i(t)):a[t]=n},i=r.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var r=a[t];if(!r.exports){var e=[];r.deps.forEach(function(t){e.push(i(t))}),r.exports=r.factory.apply(window,e)}return r.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(n,i),!o){var s=i("skylark-spa/main");u?exports=s:r.skylarkjs=s}}(function(t,r){t("skylark-langx/skylark",[],function(){var t={};return t}),t("skylark-langx/langx",["./skylark"],function(t){function r(t,r){return function(e){var n=arguments.length;if(r&&(e=Object(e)),n<2||null==e)return e;for(var i=1;i<n;i++)for(var o=arguments[i],u=t(o),a=u.length,s=0;s<a;s++){var c=u[s];r&&void 0!==e[c]||(e[c]=o[c])}return e}}function e(t,r,e,n){var i,o=t[r],u="around"==r;if(u){var a=e(function(){return o.advice(this,arguments)});i={remove:function(){a&&(a=t=e=null)},advice:function(t,r){return a?a.apply(t,r):o.advice(t,r)}}}else i={remove:function(){if(i.advice){var n=i.previous,o=i.next;o||n?(n?n.next=o:t[r]=o,o&&(o.previous=n)):delete t[r],t=e=i.advice=null}},id:st++,advice:e,receiveArguments:n};if(o&&!u)if("after"==r){for(;o.next&&(o=o.next););o.next=i,i.previous=o}else"before"==r&&(t[r]=i,i.next=o,o.previous=i);else t[r]=i;return i}function n(t){return function(r,n,i,o){var u,a=r[n];a&&a.target==r||(r[n]=u=function(){for(var t=st,r=arguments,e=u.before;e;)r=e.advice.apply(this,r)||r,e=e.next;if(u.around)var n=u.around.advice(this,r);for(var i=u.after;i&&i.id<t;){if(i.receiveArguments){var o=i.advice.apply(this,r);n=o===at?n:o}else n=i.advice.call(this,n,r);i=i.next}return n},a&&(u.around={advice:function(t,r){return a.apply(t,r)}}),u.target=r);var s=e(u||a,t,i,o);return i=null,s}}function i(t){if(!A(t))return[];var r=[];for(var e in t)r.push(e);return r}function o(t,r){var e=new CustomEvent(t,r);return J(e,r)}function u(t,r){var e,n,i=function(){t.apply(null,n)};return function(){n=arguments,clearTimeout(e),e=setTimeout(i,r)}}function a(t){for(var r=_.keys(t),e=r.length,n=Array(e),i=0;i<e;i++)n[i]=t[r[i]];return n}function s(t,r){var e;if(t===at||null===t)e=t;else if(r&&t.clone)e=t.clone();else if(m(t)){e=[];for(var n=0;n<t.length;n++)e.push(s(t[n]))}else if(j(t)){e={};for(var i in t)e[i]=s(t[i])}else e=t;return e}function c(t){return nt.call(t,function(t){return null!=t})}function f(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function l(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(r){return t}}function h(t,r){var e,n,i,o,u;if(t)if(e=t.length,e===o){for(n in t)if(t.hasOwnProperty(n)&&(u=t[n],r.call(u,n,u)===!1))break}else for(i=0;i<e&&(u=t[i],r.call(u,i,u)!==!1);i++);return this}function p(t){if(b(t)){for(var r=[],e=0;e<t.length;e++){var n=t[e];if(b(n))for(var i=0;i<n.length;i++)r.push(n[i]);else r.push(n)}return r}return t}function v(t,r,e,n){return E(r)?r.call(t,e,n):r}function g(t){var t=t||window.location.href,r=t.split("?"),e={};return r.length>1&&r[1].split("&").forEach(function(t){var r=t.split("=");e[r[0]]=r[1]}),e}function d(t,r){if(!m(r))return null!=t&&it.call(t,r);for(var e=r.length,n=0;n<e;n++){var i=r[n];if(null==t||!it.call(t,i))return!1;t=t[i]}return!!e}function y(t,r){if(!r)return-1;var e;if(r.indexOf)return r.indexOf(t);for(e=r.length;e--;)if(r[e]===t)return e;return-1}function m(t){return t&&t.constructor===Array}function b(t){return!O(t)&&!C(t)&&"number"==typeof t.length}function w(t){return"boolean"==typeof t}function x(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function k(t,r){return Y(t,r)}function E(t){return"function"==lt(t)}function A(t){return"object"==lt(t)}function j(t){return A(t)&&!P(t)&&Object.getPrototypeOf(t)==Object.prototype}function O(t){return"string"==typeof t}function P(t){return t&&t==t.window}function S(t){return"undefined"!=typeof t}function C(t){return t&&t instanceof Node}function N(t){return"number"==typeof t}function R(t){if(t){var r=location.protocol+"//"+location.hostname;return location.port&&(r+=":"+location.port),t.startsWith(r)}}function T(t){var r;for(r in t)if(null!==t[r])return!1;return!0}function D(t,r){var e=e(r),n=e.length;if(null==t)return!n;for(var i=Object(t),o=0;o<n;o++){var u=e[o];if(r[u]!==i[u]||!(u in i))return!1}return!0}function H(t){if(A(t))return[];var r=[];for(var e in t)d(t,e)&&r.push(e);return r}function U(t,r,e){return b(t)?(e||[]).concat(Array.prototype.slice.call(t,r||0)):[t]}function L(t,r){var e,n,i,o=[];if(b(t))for(n=0;n<t.length;n++)e=r.call(t[n],t[n],n),null!=e&&o.push(e);else for(i in t)e=r.call(t[i],t[i],i),null!=e&&o.push(e);return p(o)}function F(t){return requestAnimationFrame?requestAnimationFrame(t):setTimeoutout(t),this}function z(t,r){var e=2 in arguments&&et.call(arguments,2);if(E(t)){var n=function(){return t.apply(r,e?e.concat(et.call(arguments)):arguments)};return n}if(O(r))return e?(e.unshift(t[r],t),z.apply(null,e)):z(t[r],t);throw new TypeError("expected function")}function M(t){return parseFloat(t)||0}function q(t){return null==t?"":String.prototype.trim.call(t)}function $(t,r){if(m(t)){var e=t.indexOf(r);e!=-1&&t.splice(e,1)}else if(j(t))for(var n in t)if(t[n]==r){delete t[n];break}return this}function V(t,r,e,n){for(var i in r)r.hasOwnProperty(i)&&(n&&t[i]!==at||(e&&(j(r[i])||m(r[i]))?(j(r[i])&&!j(t[i])&&(t[i]={}),m(r[i])&&!m(t[i])&&(t[i]=[]),V(t[i],r[i],e,n)):r[i]!==at&&(t[i]=r[i])));return t}function Z(t){var r=et.call(arguments,0);return target=r.shift(),deep=!1,w(r[r.length-1])&&(deep=r.pop()),{target:target,sources:r,deep:deep}}function I(){var t=Z.apply(this,arguments);return t.sources.forEach(function(r){V(t.target,r,t.deep,!1)}),t.target}function B(t,r,e){m(r)||(r=[r]);var n=r.length;if(!n)return E(e)?e.call(t):e;for(var i=0;i<n;i++){var o=null==t?void 0:t[r[i]];void 0===o&&(o=e,i=n),t=E(o)?o.call(t):o}return t}function J(){var t=Z.apply(this,arguments);return t.sources.forEach(function(r){V(t.target,r,t.deep,!0)}),t.target}function W(t,r,e,n){function i(t,r){if(t.match(/\./)){var e,n=function(t,r){var i=t.pop();return i?r[i]?n(t,e=r[i]):null:e};return n(t.split(".").reverse(),r)}return r[t]}return n=n||window,e=e?z(n,e):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,o,u){var a=i(o,r);return u&&(a=i(u,n).call(n,a,o)),e(a,o).toString()})}function K(t){return t._uid||(t._uid=ht++)}function Q(t){return nt.call(t,function(r,e){return t.indexOf(r)==e})}function G(t){var r=++pt+"";return t?t+r:r}function X(){return X}var Y,tt,rt={}.toString,et=(Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice),nt=Array.prototype.filter,it=Object.prototype.hasOwnProperty,ot=Symbol?Symbol():"__pglisteners",ut="undefined"!=typeof Symbol?Symbol.prototype:null;Y=function(t,r,e,n){if(t===r)return 0!==t||1/t===1/r;if(null==t||null==r)return!1;if(t!==t)return r!==r;var i=typeof t;return("function"===i||"object"===i||"object"==typeof r)&&tt(t,r,e,n)},tt=function(t,r,e,n){var i=rt.call(t);if(i!==rt.call(r))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+r;case"[object Number]":return+t!==+t?+r!==+r:0===+t?1/+t===1/r:+t===+r;case"[object Date]":case"[object Boolean]":return+t===+r;case"[object Symbol]":return ut.valueOf.call(t)===ut.valueOf.call(r)}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof r)return!1;var u=t.constructor,a=r.constructor;if(u!==a&&!(E(u)&&u instanceof u&&E(a)&&a instanceof a)&&"constructor"in t&&"constructor"in r)return!1}e=e||[],n=n||[];for(var s=e.length;s--;)if(e[s]===t)return n[s]===r;if(e.push(t),n.push(r),o){if(s=t.length,s!==r.length)return!1;for(;s--;)if(!Y(t[s],r[s],e,n))return!1}else{var c,f=Object.keys(t);if(s=f.length,Object.keys(r).length!==s)return!1;for(;s--;)if(c=f[s],r[c]===at||!Y(t[c],r[c],e,n))return!1}return e.pop(),n.pop(),!0};var at,st=0,ct=function(){function t(t,r,e){var n=t.prototype,i=t.superclass.prototype,o=e&&e.noOverrided;for(var u in r)"constructor"!==u&&(n[u]="function"!=typeof r[u]||r[u]._constructor||o||"function"!=typeof i[u]?r[u]:function(t,r,e){return function(){var t=this.overrided;this.overrided=e;var n=r.apply(this,arguments);return this.overrided=t,n}}(u,r[u],i[u]));return t}return function r(e,n,i){var o=e.constructor;o===Object&&(o=function(){if(this.init)return this.init.apply(this,arguments)});var u=e.klassName||"",a=new Function("return function "+u+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return a._constructor=o,n=n||Object,a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.superclass=n,a.__proto__=n,a.partial||(a.partial=function(r,e){return t(this,r,e)}),a.inherit||(a.inherit=function(t,e){return r(t,this,e)}),a.partial(e,i),a}}(),ft=function(){function t(){}return function(r,e){t.prototype=r;var n=new t;return t.prototype=null,e&&I(n,e),n}}(),lt=(function(){var t;return function(r){return t||(t=document.createElement("a")),t.href=r,t.href}}(),function(){var t={};return h("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(r,e){t["[object "+e+"]"]=e.toLowerCase()}),function(r){return null==r?String(r):t[rt.call(r)]||"object"}}()),ht=1,pt=0,vt=function(){var t=this,r=this.promise=new Promise(function(r,e){t._resolve=r,t._reject=e});I(r,{then:function(t,r,e){return e&&this.progress(e),Promise.prototype.then.call(this,t,r)},done:function(t){return Promise.prototype.then.call(this,t)},fail:function(t){return Promise.prototype["catch"].call(this,t)},progress:function(r){return t[ot].push(r),this}}),this[ot]=[],this.resolve=vt.prototype.resolve.bind(this),this.reject=vt.prototype.reject.bind(this),this.progress=vt.prototype.progress.bind(this)};vt.prototype.resolve=function(t){return this._resolve.call(this.promise,t),this},vt.prototype.progress=function(t){try{return this[ot].forEach(function(r){return r(t)})}catch(r){this.reject(r)}return this},vt.prototype.reject=function(t){return this._reject.call(this.promise,t),this},vt.prototype.then=function(t,r,e){return this.promise.then(t,r,e)},vt.all=function(t){return Promise.all(t)},vt.first=function(t){return Promise.race(t)},vt.when=function(t,r,e,n){var i=t&&"function"==typeof t.then,o=i&&t instanceof Promise;if(!i)return arguments.length>1?r?r(t):t:(new vt).resolve(t);if(!o){var u=new vt(t.cancel);t.then(u.resolve,u.reject,u.progress),t=u.promise}return r||e||n?t.then(r,e,n):t},vt.reject=function(t){var r=new vt;return r.reject(t),r.promise},vt.resolve=function(t){var r=new vt;return r.resolve(t),r.promise},vt.immediate=vt.resolve;var gt=ct({on:function(t,r,e,n,i,o){var u=this,a=this._hub||(this._hub={});return j(t)?(i=n,h(t,function(t,n){u.on(t,r,e,n,i,o)}),this):(O(r)||E(n)||(i=n,n=e,e=r,r=at),E(e)&&(i=n,n=e,e=null),O(t)&&(t=t.split(/\s/)),t.forEach(function(t){(a[t]||(a[t]=[])).push({fn:n,selector:r,data:e,ctx:i,one:o})}),this)},one:function(t,r,e,n,i){return this.on(t,r,e,n,i,1)},trigger:function(t){if(!this._hub)return this;var r=this;O(t)&&(t=new CustomEvent(t)),t.target=this;var e=et.call(arguments,1);return e=S(e)?[t].concat(e):[t],[t.type||t.name,"all"].forEach(function(n){var i=r._hub[n];if(i){for(var o=i.length,u=!1,a=0;a<o;a++){var s=i[a];t.data?s.data&&(t.data=I({},s.data,t.data)):t.data=s.data||null,s.fn.apply(s.ctx,e),s.one&&(i[a]=null,u=!0)}u&&(r._hub[n]=c(i))}}),this},listened:function(t){var r=(this._hub||(this._events={}))[t]||[];return r.length>0},listenTo:function(t,r,e,n){if(!t)return this;O(e)&&(e=this[e]),n?t.one(r,e,this):t.on(r,e,this);for(var i,o=this._listeningTo||(this._listeningTo=[]),u=0;u<o.length;u++)if(o[u].obj==t){i=o[u];break}i||o.push(i={obj:t,events:{}});var a=i.events,s=a[r]=a[r]||[];return s.indexOf(e)==-1&&s.push(e),this},listenToOnce:function(t,r,e){return this.listenTo(t,r,e,1)},off:function(t,r){var e=this._hub||(this._hub={});return O(t)&&(t=t.split(/\s/)),t.forEach(function(t){var n=e[t],i=[];if(n&&r)for(var o=0,u=n.length;o<u;o++)n[o].fn!==r&&n[o].fn._!==r&&i.push(n[o]);i.length?e[t]=i:delete e[t]}),this},unlistenTo:function(t,r,e){var n=this._listeningTo;if(!n)return this;for(var i=0;i<n.length;i++){var o=n[i];if(!t||t==o.obj){var u=o.events;for(var a in u)if(!r||r==a){listeningEvent=u[a];for(var s=0;s<listeningEvent.length;s++)e&&e!=listeningEvent[i]||(o.obj.off(a,listeningEvent[i],this),listeningEvent[i]=null);listeningEvent=u[a]=c(listeningEvent),T(listeningEvent)&&(u[a]=null)}T(u)&&(n[i]=null)}}return n=this._listeningTo=c(n),T(n)&&(this._listeningTo=null),this}}),dt=gt.inherit({init:function(t,r){var e=t||{};r||(r={}),this.cid=G(this.cidPrefix),this.attributes={},r.collection&&(this.collection=r.collection),r.parse&&(e=this.parse(e,r)||{});var n=B(this,"defaults");e=I({},n,e),this.set(e,r),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(t){return s(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return null!=this.get(t)},set:function(t,r,e){if(null==t)return this;var n;if("object"==typeof t?(n=t,e=r):(n={})[t]=r,e||(e={}),!this._validate(n,e))return!1;var i=e.unset,o=e.silent,u=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=s(this.attributes),this.changed={});var c=this.attributes,f=this.changed,l=this._previousAttributes;for(var h in n)r=n[h],k(c[h],r)||u.push(h),k(l[h],r)?delete f[h]:f[h]=r,i?delete c[h]:c[h]=r;if(this.idAttribute in n&&(this.id=this.get(this.idAttribute)),!o){u.length&&(this._pending=e);for(var p=0;p<u.length;p++)this.trigger("change:"+u[p],this,c[u[p]],e)}if(a)return this;if(!o)for(;this._pending;)e=this._pending,this._pending=!1,this.trigger("change",this,e);return this._pending=!1,this._changing=!1,this},unset:function(t,r){return this.set(t,void 0,I({},r,{unset:!0}))},clear:function(t){var r={};for(var e in this.attributes)r[e]=void 0;return this.set(r,I({},t,{unset:!0}))},hasChanged:function(t){return null==t?!T(this.changed):this.changed[t]!==at},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&s(this.changed);var r=this._changing?this._previousAttributes:this.attributes,e={};for(var n in t){var i=t[n];k(r[n],i)||(e[n]=i)}return!T(e)&&e},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},I({},t,{validate:!0}))},_validate:function(t,r){if(!r.validate||!this.validate)return!0;t=I({},this.attributes,t);var e=this.validationError=this.validate(t,r)||null;return!e||(this.trigger("invalid",this,e,I(r,{validationError:e})),!1)}});return I(X,{after:n("after"),allKeys:i,around:n("around"),before:n("before"),camelCase:function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})},clone:s,compact:c,createEvent:o,dasherize:f,debounce:u,defaults:r(i,!0),delegate:ft,Deferred:vt,Evented:gt,defer:F,deserializeValue:l,each:h,flatten:p,funcArg:v,getQueryParams:g,has:d,inArray:y,isArray:m,isArrayLike:b,isBoolean:w,isDefined:function(t){return t!==at},isDocument:x,isEmptyObject:T,isEqual:k,isFunction:E,isHtmlNode:C,isMatch:D,isNumber:N,isObject:A,isPlainObject:j,isString:O,isSameOrigin:R,isWindow:P,keys:H,klass:function(t,r,e){return ct(t,r,e)},lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},makeArray:U,map:L,mixin:I,proxy:z,removeItem:$,result:B,returnTrue:function(){return!0},returnFalse:function(){return!1},safeMixin:J,serializeValue:function(t){return JSON.stringify(t)},Stateful:dt,substitute:W,toPixel:M,trim:q,type:lt,uid:K,uniq:Q,uniqueId:G,upperFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},URL:"undefined"!=typeof window?window.URL||window.webkitURL:null,values:a}),t.langx=X}),t("skylark-router/router",["skylark-langx/skylark","skylark-langx/langx"],function(t,r){function e(t,e){var n=new CustomEvent(t,e);return r.safeMixin(n,e)}function n(){return g}function i(t){if(g){var n=g.route.exit({path:g.path,params:g.params},!0);if(!n)return}if(d=g,g=t,!g.route){var i=u(g.path);g.route=i.route,g.params=i.params}var o=g.route.enter({force:g.force,path:g.path,params:g.params},!0);r.Deferred.when(o).then(function(){w.trigger(e("routing",{current:g,previous:d})),g.route.enter({path:g.path,params:g.params},!1),d&&d.route.exit({path:d.path,params:d.params},!1),w.trigger(e("routed",{current:g,previous:d}))})}function o(t,r){if(!r&&g&&g.path==t)return!1;var n=u(t);if(n)if(n.path=t,k.useHistoryApi){var o={force:r,path:t};window.history.pushState(o,document.title,(y+t).replace("//","/")),window.dispatchEvent(e("popstate",{state:o}))}else if(k.useHashbang){var a="#!"+t;window.location.hash!==a?window.location.hash=a:i(n)}else i(n);return!0}function u(t,e){var n=!1;return!e&&(n=_[t])?n:(r.each(b,function(r,e){var i=e.match(t);return!i||(n={route:e,params:i},!1)}),n&&!e&&(_[t]=n),n)}function a(t,r){var e,n=b[t];return n&&(e=n.path(r)),e}function s(){return d}function c(t){return r.isDefined(t)?(y=t,this):y}function f(){return w}function l(t){return r.isDefined(t)?(m=t,this):m}function h(t,e){if(r.isDefined(e)){var n={};return n[t]=e,p(n),this}return b[t]}function p(t){if(!r.isDefined(t))return r.mixin({},b);for(var e in t)b[e]=new k.Route(e,t[e])}function v(){null==k.useHashbang&&null==k.useHistoryApi&&(window.location.host&&window.history.pushState?k.useHistoryApi=!0:k.useHashbang=!0);var t="";k.useHistoryApi?(t=window.location.pathname,void 0===y&&(y=t.replace(/\/$/,"")),t=t.replace(y,"")||m||"/"):t=k.useHashbang?window.location.hash.replace("#!","")||m||"/":"/",t.startsWith("/")||(t="/"+t),k.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&i(t.state),t.preventDefault()}):k.useHashbang&&window.addEventListener("hashchange",function(t){i({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()}),o(t)}var g,d,y,m,b={},_={},w=new r.Evented,x=r.Evented.inherit({klassName:"Route",init:function(t,e){e=r.mixin({},e);var n=e.pathto||"",i=n,o=i.match(/\:([a-zA-Z0-9_]+)/g);null!==o?(o=o.map(function(t){return t.substring(1)}),i=i.replace(/\:([a-zA-Z0-9_]+)/g,"(.*?)")):o=[],i="*"===i?"(.*)":i.replace("/","\\/"),this._setting=e,this.name=t,this.pathto=n,this.paramNames=o,this.params=i,this.regex=new RegExp("^"+i+"$","");var u=this;["entering","entered","exiting","exited"].forEach(function(t){r.isFunction(e[t])&&u.on(t,e[t])})},enter:function(t,n){if(n){var i=this._entering(t),o=this;return r.Deferred.when(i).then(function(){var t=e("entering",{route:o,result:!0});return o.trigger(t),t.result})}return this._entered(t),this.trigger(e("entered",r.safeMixin({route:this},t))),this},exit:function(t,n){if(n){var i=this._exiting(t);if(!i)return!1;var o=e("exiting",{route:this,result:!0});return this.trigger(o),o.result}return this._exited(t),this.trigger(e("exited",r.safeMixin({route:this},t))),this},match:function(t){var r=this.paramNames,e=t.indexOf("?"),t=~e?t.slice(0,e):decodeURIComponent(t),n=this.regex.exec(t);if(!n)return!1;for(var i={},o=1,u=n.length;o<u;++o){var a=r[o-1],s=decodeURIComponent(n[o]);i[a]=s}return i},path:function(t){var r=this.pathto;return t&&(r=r.replace(/:([a-zA-Z0-9_]+)/g,function(r,e){return t[e]})),r},_entering:function(t){return!0},_entered:function(t){return!0},_exiting:function(t){return!0},_exited:function(t){return!0}}),k=function(){return k};return r.mixin(k,{Route:x,current:n,go:o,map:u,hub:f,off:function(){w.off.apply(w,arguments)},on:function(){w.on.apply(w,arguments)},one:function(){w.one.apply(w,arguments)},path:a,previous:s,baseUrl:c,homePath:l,route:h,routes:p,start:v,trigger:function(t){return w.trigger(t),this},useHistoryApi:null,useHashbang:null}),t.router=k}),t("skylark-router",["skylark-router/router"],function(t){return t}),t("skylark-spa/spa",["skylark-langx/skylark","skylark-langx/langx","skylark-router/router"],function(t,e,n){function i(t,r){var n=new CustomEvent(t,r);return e.safeMixin(n,r)}var o,u=e.Deferred,a=n.Route=n.Route.inherit({klassName:"SpaRoute",init:function(t,r){this.overrided(t,r),this.content=r.content,this.forceRefresh=r.forceRefresh,this.data=r.data;var n=this;["preparing","rendering","rendered"].forEach(function(t){e.isFunction(r[t])&&n.on(t,r[t])})},_entering:function(t){return this.forceRefresh||t.force||!this._prepared?this.prepare():this},getConfigData:function(t){return t?this.data[t]:this.data},getNamedValue:function(){return window.location.pathname.match(this.regex)},prepare:function(){var t=new u,e=this._setting,n=e.controller,o=this.controller,a=this;e.content,e.contentPath;return r([n.type],function(r){o=a.controller=new r(n),t.resolve()}),t.then(function(){var t=i("preparing",{route:a,result:!0});return a.trigger(t),u.when(t.result).then(function(){a._prepared=!0})})},render:function(t){var r=i("rendering",{route:this,context:t,content:this.content});return this.trigger(r),r.content},trigger:function(t){var r=this.controller;return r?r.perform(t):this.overrided(t)}}),s=e.Evented.inherit({klassName:"SpaRouteController",init:function(t,r){r=r||{},this.content=r.content,this.data=r.data},getConfigData:function(t){return t?this.data[t]:this.data},perform:function(t){var r=t.type;if(this[r])return this[r].call(this,t)}}),c=e.Evented.inherit({klassName:"SpaPage",init:function(t){t=e.mixin({routeViewer:"body"},t),this._params=t,this._rvc=document.querySelector(t.routeViewer),this._router=n,n.on("routed",e.proxy(this,"refresh"))},prepare:function(){},refresh:function(){var t=n.current(),r=(n.previous(),t.route.render(t));void 0!==r&&null!==r&&(e.isString(r)?this._rvc.innerHTML=r:(this._rvc.innerHTML="",this._rvc.appendChild(r)),t.route.trigger(i("rendered",{route:t.route,content:r})))}}),f=e.Evented.inherit({klassName:"SpaPlugin",init:function(t,r){this.name=t,e.isString(r.hookers)&&(r.hookers=r.hookers.split(" ")),this._setting=r},isHooked:function(t){var r=this._setting.hookers||[];return r.indexOf(t)>-1},prepare:function(){var t=new u,o=this._setting,a=o.controller,s=this.controller,c=this;return r([a.type],function(r){s=c.controller=new r(a),n.on(o.hookers,{plugin:c},e.proxy(s.perform,s)),t.resolve()}),t.then(function(){var t=i("preparing",{plugin:c,result:!0});return c.trigger(t),u.when(t.result).then(function(){c._prepared=!0})})},trigger:function(t){var r=this.controller;return r?r.perform(t):this.overrided(t)}}),l=e.Evented.inherit({klassName:"SpaPluginController",init:function(t){this.plugin=t},perform:function(t){var r=t.type;if(this[r])return this[r].call(this,t)}}),h=e.Evented.inherit({klassName:"SpaApplication",init:function(t){if(o)return o;var r=this._plugins={};t=this._config=e.mixin({plugins:{}},t,!0),e.each(t.plugins,function(t,e){r[t]=new f(t,e)}),n.routes(t.routes),this._router=n,this._page=new p.Page(t.page),document.title=t.title;var i=t.baseUrl;void 0===i&&(i=t.baseUrl=new e.URL(document.baseURI).pathname),n.baseUrl(i),t.homePath&&n.homePath(t.homePath),o=this},baseUrl:function(){return n.baseUrl()},getConfig:function(t){return t?this._config[t]:this._config},go:function(t,r){return n.go(t,r),this},page:function(){return this._page},prepare:function(){if(this._prepared)return u.resolve();var t=this,r=e.map(this._plugins,function(t,r){if(t.isHooked("starting"))return t.prepare()});return u.all(r).then(function(){n.trigger(i("starting",{spa:t}));var r=e.map(n.routes(),function(t,r){if(t.lazy===!1)return t.prepare()}),o=e.map(t._plugins,function(t,r){if(!t.isHooked("starting"))return t.prepare()});return u.all(r.concat(o)).then(function(){t._prepared=!0})})},run:function(){this._router.start(),n.trigger(i("started",{spa:this}))}}),p=function(t){return o||(window[t.name||"app"]=o=new p.Application(t)),o};return e.mixin(p,{Application:h,Page:c,Plugin:f,PluginController:l,Route:a,RouteController:s}),t.spa=p}),t("skylark-spa/main",["skylark-langx/skylark","./spa"],function(t){return t}),t("skylark-spa",["skylark-spa/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-spa-all.js.map
