/**
 * skylark-spa - An Elegant  HTML5 Single Page Application Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.3
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,n){function e(t,n){if("."!==t[0])return t;var e=n.split("/"),r=t.split("/");e.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?e.pop():e.push(r[i]));return e.join("/")}var r=n.define,i=n.require,o="function"==typeof r&&r.amd,u=!o&&"undefined"!=typeof exports;if(!o&&!r){var a={};r=n.define=function(t,n,r){"function"==typeof r?(a[t]={factory:r,deps:n.map(function(n){return e(n,t)}),exports:null},i(t)):resolved[t]=r},i=n.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var n=a[t];if(!n.exports){var e=[];n.deps.forEach(function(t){e.push(i(t))}),n.exports=n.factory.apply(window,e)}return n.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(r,i),o)r(["skylark-spa"],function(t){return t});else{var s=i("skylark-spa/main");u?exports=s:n.skylarkjs=s}}(function(t,n){t("skylark-langx/skylark",[],function(){var t={};return t}),t("skylark-langx/langx",["./skylark"],function(t){function n(t){var e;if(void 0===t||null===t)e=t;else if(t.clone)e=t.clone();else if(l(t)){e=[];for(var r=0;r<t.length;r++)e.push(n(t[r]))}else if(m(t)){e={};for(var i in t)e[i]=n(t[i])}else e=t;return e}function e(t,n){var e,r,i=function(){t.apply(null,r)};return function(){r=arguments,clearTimeout(e),e=setTimeout(i,n)}}function r(t){return q.call(t,function(t){return null!=t})}function i(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function o(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(n){return t}}function u(t,n){var e,r,i,o,u;if(t)if(e=t.length,e===o){for(r in t)if(t.hasOwnProperty(r)&&(u=t[r],n.call(u,r,u)===!1))break}else for(i=0;i<e&&(u=t[i],n.call(u,i,u)!==!1);i++);return this}function a(t){if(p(t)){for(var n=[],e=0;e<t.length;e++){var r=t[e];if(p(r))for(var i=0;i<r.length;i++)n.push(r[i]);else n.push(r)}return n}return t}function s(t,n,e,r){return v(n)?n.call(t,e,r):n}function c(t){var t=t||window.location.href,n=t.split("?"),e={};return n.length>1&&n[1].split("&").forEach(function(t){var n=t.split("=");e[n[0]]=n[1]}),e}function f(t,n){if(!n)return-1;var e;if(n.indexOf)return n.indexOf(t)>-1;for(e=n.length;e--;)if(n[e]===t)return!0;return!1}function l(t){return t instanceof Array}function p(t){return!(y(t)||t.nodeName&&"#text"==t.nodeName||"number"!=typeof t.length)}function h(t){return"boolean"==typeof t}function g(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function v(t){return"function"==B(t)}function d(t){return"object"==B(t)}function m(t){return d(t)&&!w(t)&&Object.getPrototypeOf(t)==Object.prototype}function y(t){return"string"==typeof t}function w(t){return t&&t==t.window}function k(t){return"undefined"!=typeof t}function _(t){return t&&t instanceof Node}function x(t){return"number"==typeof t}function b(t){if(t){var n=location.protocol+"//"+location.hostname;return location.port&&(n+=":"+location.port),t.startsWith(n)}}function E(t){var n;for(n in t)if(null!==t[n])return!1;return!0}function A(t,n,e){return(e||[]).concat(Array.prototype.slice.call(t,n||0))}function O(t,n){var e,r,i,o=[];if(p(t))for(r=0;r<t.length;r++)e=n.call(t[r],t[r],r),null!=e&&o.push(e);else for(i in t)e=n.call(t[i],t[i],i),null!=e&&o.push(e);return a(o)}function j(t){return requestAnimationFrame(t),this}function P(t,n){var e=2 in arguments&&$.call(arguments,2);if(v(t)){var r=function(){return t.apply(n,e?e.concat($.call(arguments)):arguments)};return r}if(y(n))return e?(e.unshift(t[n],t),P.apply(null,e)):P(t[n],t);throw new TypeError("expected function")}function N(t){return parseFloat(t)||0}function R(t){return null==t?"":String.prototype.trim.call(t)}function C(t,n){if(l(t)){var e=t.indexOf(n);e!=-1&&t.splice(e,1)}else if(m(t))for(var r in t)if(t[r]==n){delete t[r];break}return this}function S(t,n,e,r){for(var i in n)n.hasOwnProperty(i)&&(r&&void 0!==t[i]||(e&&(m(n[i])||l(n[i]))?(m(n[i])&&!m(t[i])&&(t[i]={}),l(n[i])&&!l(t[i])&&(t[i]=[]),S(t[i],n[i],e,r)):void 0!==n[i]&&(t[i]=n[i])));return t}function T(t){var n=$.call(arguments,0);return target=n.shift(),deep=!1,h(n[n.length-1])&&(deep=n.pop()),{target:target,sources:n,deep:deep}}function H(){var t=T.apply(this,arguments);return t.sources.forEach(function(n){S(t.target,n,t.deep,!1)}),t.target}function D(){var t=T.apply(this,arguments);return t.sources.forEach(function(n){S(t.target,n,t.deep,!0)}),t.target}function U(t,n,e,r){function i(t,n){if(t.match(/\./)){var e,r=function(t,n){var i=t.pop();return i?n[i]?r(t,e=n[i]):null:e};return r(t.split(".").reverse(),n)}return n[t]}return r=r||window,e=e?P(r,e):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,o,u){var a=i(o,n);return u&&(a=i(u,r).call(r,a,o)),e(a,o).toString()})}function L(t){return t._uid||t.id||(t._uid=J++)}function z(t){return q.call(t,function(n,e){return t.indexOf(n)==e})}function F(){return F}var M={}.toString,$=(Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice),q=Array.prototype.filter,Z=function(){function t(t,n,e){var r=t.prototype,i=t.superclass.prototype,o=e&&e.noOverrided;for(var u in n)"constructor"!==u&&(r[u]="function"!=typeof n[u]||o||"function"!=typeof i[u]?n[u]:function(t,n,e){return function(){var t=this.overrided;this.overrided=e;var r=n.apply(this,arguments);return this.overrided=t,r}}(u,n[u],i[u]));return t}return function n(e,r,i){var o=e.constructor;o===Object&&(o=function(){this.init&&this.init.apply(this,arguments)});var u=e.klassName||"",a=new Function("return function "+u+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}ctor._constructor.apply(inst, arguments);return inst;}")();return a._constructor=o,r=r||Object,a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.superclass=r,a.__proto__=r,a.partial||(a.partial=function(n,e){return t(this,n,e)}),a.inherit||(a.inherit=function(t,e){return n(t,this,e)}),a.partial(e,i),a}}(),V=function(){function t(){}return function(n,e){t.prototype=n;var r=new t;return t.prototype=null,e&&H(r,e),r}}(),I=function(){this.promise=new Promise(function(t,n){this._resolve=t,this._reject=n}.bind(this)),this.resolve=I.prototype.resolve.bind(this),this.reject=I.prototype.reject.bind(this)};I.prototype.resolve=function(t){return this._resolve.call(this.promise,t),this},I.prototype.reject=function(t){return this._reject.call(this.promise,t),this},I.prototype.then=function(t,n,e){return this.promise.then(t,n,e)},I.all=function(t){return Promise.all(t)},I.first=function(t){return Promise.race(t)},I.when=function(t,n,e,r){var i=t&&"function"==typeof t.then,o=i&&t instanceof Promise;if(!i)return arguments.length>1?n?n(t):t:(new I).resolve(t);if(!o){var u=new I(t.cancel);t.then(u.resolve,u.reject,u.progress),t=u.promise}return n||e||r?t.then(n,e,r):t},I.reject=function(t){var n=new I;return n.reject(t),n.promise},I.resolve=function(t){var n=new I;return n.resolve(t),n.promise},I.immediate=I.resolve;var W=Z({on:function(t,n,e,r,i,o){var a=this,s=this._hub||(this._hub={});return m(t)?(i=r,u(t,function(t,r){a.on(t,n,e,r,i,o)}),this):(y(n)||v(r)||(i=r,r=e,e=n,n=void 0),v(e)&&(i=r,r=e,e=null),y(t)&&(t=t.split(/\s/)),t.forEach(function(t){(s[t]||(s[t]=[])).push({fn:r,selector:n,data:e,ctx:i,one:o})}),this)},one:function(t,n,e,r,i){return this.on(t,n,e,r,i,1)},trigger:function(t){if(!this._hub)return this;var n=this;y(t)&&(t=new CustomEvent(t));var e=$.call(arguments,1);return e=k(e)?[t].concat(e):[t],[t.type||t.name,"all"].forEach(function(i){var o=n._hub[i];if(o){for(var u=o.length,a=!1,s=0;s<u;s++){var c=o[s];t.data?c.data&&(t.data=H({},c.data,t.data)):t.data=c.data||null,c.fn.apply(c.ctx,e),c.one&&(o[s]=null,a=!0)}a&&(n._hub[i]=r(o))}}),this},listened:function(t){var n=(this._hub||(this._events={}))[t]||[];return n.length>0},listenTo:function(t,n,e,r){if(!t)return this;y(e)&&(e=this[e]),r?t.one(n,e,this):t.on(n,e,this);for(var i,o=this._listeningTo||(this._listeningTo=[]),u=0;u<o.length;u++)if(o[u].obj==t){i=o[u];break}i||o.push(i={obj:t,events:{}});var a=i.events,s=a[n]=a[n]||[];return s.indexOf(e)==-1&&s.push(e),this},listenToOnce:function(t,n,e){return this.listenTo(t,n,e,1)},off:function(t,n){var e=this._hub||(this._hub={});return y(t)&&(t=t.split(/\s/)),t.forEach(function(t){var r=e[t],i=[];if(r&&n)for(var o=0,u=r.length;o<u;o++)r[o].fn!==n&&r[o].fn._!==n&&i.push(r[o]);i.length?e[t]=i:delete e[t]}),this},unlistenTo:function(t,n,e){var i=this._listeningTo;if(!i)return this;for(var o=0;o<i.length;o++){var u=i[o];if(!t||t==u.obj){var a=u.events;for(var s in a)if(!n||n==s){listeningEvent=a[s];for(var c=0;c<listeningEvent.length;c++)e&&e!=listeningEvent[o]||(u.obj.off(s,listeningEvent[o],this),listeningEvent[o]=null);listeningEvent=a[s]=r(listeningEvent),E(listeningEvent)&&(a[s]=null)}E(a)&&(i[o]=null)}}return i=this._listeningTo=r(i),E(i)&&(this._listeningTo=null),this}}),B=(function(){var t;return function(n){return t||(t=document.createElement("a")),t.href=n,t.href}}(),function(){var t={};return u("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(n,e){t["[object "+e+"]"]=e.toLowerCase()}),function(n){return null==n?String(n):t[M.call(n)]||"object"}}()),J=1;return H(F,{camelCase:function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})},clone:n,compact:r,dasherize:i,debounce:e,delegate:V,Deferred:I,Evented:W,deserializeValue:o,each:u,flatten:a,funcArg:s,getQueryParams:c,inArray:f,isArray:l,isArrayLike:p,isBoolean:h,isDefined:function(t){return void 0!==t},isDocument:g,isEmptyObject:E,isFunction:v,isHtmlNode:_,isObject:d,isPlainObject:m,isNumber:x,isString:y,isSameOrigin:b,isWindow:w,klass:function(t,n,e){return Z(t,n,e)},lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},makeArray:A,map:O,mixin:H,nextTick:j,proxy:P,removeItem:C,returnTrue:function(){return!0},returnFalse:function(){return!1},safeMixin:D,serializeValue:function(t){return JSON.stringify(t)},substitute:U,toPixel:N,trim:R,type:B,uid:L,uniq:z,upperFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},URL:window.URL||window.webkitURL}),t.langx=F}),t("skylark-router/router",["skylark-langx/skylark","skylark-langx/langx"],function(t,n){function e(t,e){var r=new CustomEvent(t,e);return n.safeMixin(r,e)}function r(){return v}function i(t){if(v){var r=v.route.exit({path:v.path,params:v.params},!0);if(!r)return}if(d=v,v=t,!v.route){var i=u(v.path);v.route=i.route,v.params=i.params}var o=v.route.enter({force:v.force,path:v.path,params:v.params},!0);n.Deferred.when(o).then(function(){_.trigger(e("routing",{current:v,previous:d})),v.route.enter({path:v.path,params:v.params},!1),d&&d.route.exit({path:d.path,params:d.params},!1),_.trigger(e("routed",{current:v,previous:d}))})}function o(t,n){if(!n&&v&&v.path==t)return!1;var r=u(t);if(r)if(r.path=t,b.useHistoryApi){var o={force:n,path:t};window.history.pushState(o,document.title,(m+t).replace("//","/")),window.dispatchEvent(e("popstate",{state:o}))}else if(b.useHashbang){var a="#!"+t;window.location.hash!==a?window.location.hash=a:i(r)}else i(r);return!0}function u(t,e){var r=!1;return!e&&(r=k[t])?r:(n.each(w,function(n,e){var i=e.match(t);return!i||(r={route:e,params:i},!1)}),r&&!e&&(k[t]=r),r)}function a(t,n){var e,r=w[t];return r&&(e=r.path(n)),e}function s(){return d}function c(t){return n.isDefined(t)?(m=t,this):m}function f(){return _}function l(t){return n.isDefined(t)?(y=t,this):y}function p(t,e){if(n.isDefined(e)){var r={};return r[t]=e,h(r),this}return w[t]}function h(t){if(!n.isDefined(t))return n.mixin({},w);for(var e in t)w[e]=new b.Route(e,t[e])}function g(){null==b.useHashbang&&null==b.useHistoryApi&&(window.location.host&&window.history.pushState?b.useHistoryApi=!0:b.useHashbang=!0);var t="";b.useHistoryApi?(t=window.location.pathname,void 0===m&&(m=t.replace(/\/$/,"")),t=t.replace(m,"")||y||"/"):t=b.useHashbang?window.location.hash.replace("#!","")||y||"/":"/",t.startsWith("/")||(t="/"+t),b.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&i(t.state),t.preventDefault()}):b.useHashbang&&window.addEventListener("hashchange",function(t){i({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()}),o(t)}var v,d,m,y,w={},k={},_=new n.Evented,x=n.Evented.inherit({klassName:"Route",init:function(t,e){e=n.mixin({},e);var r=e.pathto||"",i=r,o=i.match(/\:([a-zA-Z0-9_]+)/g);null!==o?(o=o.map(function(t){return t.substring(1)}),i=i.replace(/\:([a-zA-Z0-9_]+)/g,"(.*?)")):o=[],i="*"===i?"(.*)":i.replace("/","\\/"),this._setting=e,this.name=t,this.pathto=r,this.paramNames=o,this.params=i,this.regex=new RegExp("^"+i+"$","");var u=this;["entering","entered","exiting","exited"].forEach(function(t){n.isFunction(e[t])&&u.on(t,e[t])})},enter:function(t,r){if(r){var i=this._entering(t),o=this;return n.Deferred.when(i).then(function(){var t=e("entering",{route:o,result:!0});return o.trigger(t),t.result})}return this._entered(t),this.trigger(e("entered",n.safeMixin({route:this},t))),this},exit:function(t,r){if(r){var i=this._exiting(t);if(!i)return!1;var o=e("exiting",{route:this,result:!0});return this.trigger(o),o.result}return this._exited(t),this.trigger(e("exited",n.safeMixin({route:this},t))),this},match:function(t){var n=this.paramNames,e=t.indexOf("?"),t=~e?t.slice(0,e):decodeURIComponent(t),r=this.regex.exec(t);if(!r)return!1;for(var i={},o=1,u=r.length;o<u;++o){var a=n[o-1],s=decodeURIComponent(r[o]);i[a]=s}return i},path:function(t){var n=this.pathto;return t&&(n=n.replace(/:([a-zA-Z0-9_]+)/g,function(n,e){return t[e]})),n},_entering:function(t){return!0},_entered:function(t){return!0},_exiting:function(t){return!0},_exited:function(t){return!0}}),b=function(){return b};return n.mixin(b,{Route:x,current:r,go:o,map:u,hub:f,off:function(){_.off.apply(_,arguments)},on:function(){_.on.apply(_,arguments)},one:function(){_.one.apply(_,arguments)},path:a,previous:s,baseUrl:c,homePath:l,route:p,routes:h,start:g,trigger:function(t){return _.trigger(t),this},useHistoryApi:null,useHashbang:null}),t.router=b}),t("skylark-router",["skylark-router/router"],function(t){return t}),t("skylark-spa/spa",["skylark-langx/skylark","skylark-langx/langx","skylark-router/router"],function(t,e,r){function i(t,n){var r=new CustomEvent(t,n);return e.safeMixin(r,n)}var o,u=e.Deferred,a=r.Route=r.Route.inherit({klassName:"SpaRoute",init:function(t,n){this.overrided(t,n),this.content=n.content,this.forceRefresh=n.forceRefresh,this.data=n.data;var r=this;["preparing","rendering","rendered"].forEach(function(t){e.isFunction(n[t])&&r.on(t,n[t])})},_entering:function(t){return this.forceRefresh||t.force||!this._prepared?this.prepare():this},getConfigData:function(t){return t?this.data[t]:this.data},getNamedValue:function(){return window.location.pathname.match(this.regex)},prepare:function(){var t=new u,e=this._setting,r=e.controller,o=this.controller,a=this;e.content,e.contentPath;return n([r.type],function(n){o=a.controller=new n(r),t.resolve()}),t.then(function(){var t=i("preparing",{route:a,result:!0});return a.trigger(t),u.when(t.result).then(function(){a._prepared=!0})})},render:function(t){var n=i("rendering",{route:this,context:t,content:this.content});return this.trigger(n),n.content},trigger:function(t){var n=this.controller;return n?n.perform(t):this.overrided(t)}}),s=e.Evented.inherit({klassName:"SpaRouteController",init:function(t,n){n=n||{},this.content=n.content,this.data=n.data},getConfigData:function(t){return t?this.data[t]:this.data},perform:function(t){var n=t.type;if(this[n])return this[n].call(this,t)}}),c=e.Evented.inherit({klassName:"SpaPage",init:function(t){t=e.mixin({routeViewer:"body"},t),this._params=t,this._rvc=document.querySelector(t.routeViewer),this._router=r,r.on("routed",e.proxy(this,"refresh"))},prepare:function(){},refresh:function(){var t=r.current(),n=(r.previous(),t.route.render(t));e.isString(n)?this._rvc.innerHTML=n:(this._rvc.innerHTML="",this._rvc.appendChild(n)),t.route.trigger(i("rendered",{route:t.route,content:n}))}}),f=e.Evented.inherit({klassName:"SpaPlugin",init:function(t,n){this.name=t,e.isString(n.hookers)&&(n.hookers=n.hookers.split(" ")),this._setting=n},isHooked:function(t){var n=this._setting.hookers||[];return n.indexOf(t)>-1},prepare:function(){var t=new u,o=this._setting,a=o.controller,s=this.controller,c=this;return n([a.type],function(n){s=c.controller=new n(a),r.on(o.hookers,{plugin:c},e.proxy(s.perform,s)),t.resolve()}),t.then(function(){var t=i("preparing",{plugin:c,result:!0});return c.trigger(t),u.when(t.result).then(function(){c._prepared=!0})})},trigger:function(t){var n=this.controller;return n?n.perform(t):this.overrided(t)}}),l=e.Evented.inherit({klassName:"SpaPluginController",init:function(t){this.plugin=t},perform:function(t){var n=t.type;if(this[n])return this[n].call(this,t)}}),p=e.Evented.inherit({klassName:"SpaApplication",init:function(t){if(o)return o;var n=this._plugins={};t=this._config=e.mixin({plugins:{}},t,!0),e.each(t.plugins,function(t,e){n[t]=new f(t,e)}),r.routes(t.routes),this._router=r,this._page=new h.Page(t.page),document.title=t.title;var i=t.baseUrl;void 0===i&&(i=t.baseUrl=new e.URL(document.baseURI).pathname),r.baseUrl(i),t.homePath&&r.homePath(t.homePath),o=this},getConfig:function(t){return t?this._config[t]:this._config},go:function(t,n){return r.go(t,n),this},page:function(){return this._page},prepare:function(){if(this._prepared)return u.resolve();var t=this,n=e.map(this._plugins,function(t,n){if(t.isHooked("starting"))return t.prepare()});return u.all(n).then(function(){r.trigger(i("starting",{spa:t}));var n=e.map(r.routes(),function(t,n){if(t.lazy===!1)return t.prepare()}),o=e.map(t._plugins,function(t,n){if(!t.isHooked("starting"))return t.prepare()});return u.all(n.concat(o)).then(function(){t._prepared=!0})})},run:function(){this._router.start(),r.trigger(i("started",{spa:this}))}}),h=function(t){return o||(window[t.name||"app"]=o=new h.Application(t)),o};return e.mixin(h,{Application:p,Page:c,Plugin:f,PluginController:l,Route:a,RouteController:s}),t.spa=h}),t("skylark-spa/main",["skylark-langx/skylark","./spa"],function(t){return t}),t("skylark-spa",["skylark-spa/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-spa-all.js.map
