/**
 * skylark-utils - An Elegant HTML5 JavaScript Library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.3
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./skylark","./langx","./noder","./datax","./finder","./geom","./eventer","./styler"],function(r,a,e,n,g,t,s,i){function d(r,a){return new u(r,a)}function o(r,a){return new p(r,a)}function l(){return l}var f=(s.on,s.off,n.attr,n.removeAttr,t.pagePosition,i.addClass,t.height,a.Evented.inherit({klassName:"DndManager",init:function(){},prepare:function(r){var a=s.create("preparing",{dragSource:r.elm,handleElm:r.handleElm});r.trigger(a),r.dragSource=a.dragSource},start:function(r,e){var n=t.pagePosition(r.elm);this.draggingOffsetX=parseInt(e.pageX-n.left),this.draggingOffsetY=parseInt(e.pageY-n.top);var g=s.create("started",{elm:r.elm,dragSource:r.dragSource,handleElm:r.handleElm,ghost:null,transfer:{}});r.trigger(g),this.dragging=r,r.draggingClass&&i.addClass(r.dragSource,r.draggingClass),this.draggingGhost=g.ghost,this.draggingGhost||(this.draggingGhost=r.elm),this.draggingTransfer=g.transfer,this.draggingTransfer&&a.each(this.draggingTransfer,function(r,a){e.dataTransfer.setData(r,a)}),e.dataTransfer.setDragImage(this.draggingGhost,this.draggingOffsetX,this.draggingOffsetY),e.dataTransfer.effectAllowed="copyMove",this.trigger(g)},over:function(){},end:function(r){var a=this.dragging;a&&a.draggingClass&&i.removeClass(a.dragSource,a.draggingClass);var e=s.create("ended",{});this.trigger(e),this.dragging=null,this.draggingTransfer=null,this.draggingGhost=null,this.draggingOffsetX=null,this.draggingOffsetY=null}})),c=new f,u=a.Evented.inherit({klassName:"Draggable",init:function(r,e){var t=this;t.elm=r,t.draggingClass=e.draggingClass||"dragging",t._params=e,["preparing","started","ended","moving"].forEach(function(r){a.isFunction(e[r])&&t.on(r,e[r])}),s.on(r,{mousedown:function(r){e.handle&&(t.handleElm=g.closest(r.target,e.handle),!t.handleElm)||(c.prepare(t),t.dragSource&&n.prop(t.dragSource,"draggable",!0))},mouseup:function(r){t.dragSource&&(n.prop(t.dragSource,"draggable",!1),t.dragSource=null,t.handleElm=null)},dragstart:function(r){n.prop(t.dragSource,"draggable",!1),c.start(t,r)},dragend:function(r){s.stop(r),c.dragging&&c.end(!1)}})}}),p=a.Evented.inherit({klassName:"Droppable",init:function(r,e){var n,g,t=this,d=(e.draggingClass||"dragging",!0);t.elm=r,t._params=e,["started","entered","leaved","dropped","overing"].forEach(function(r){a.isFunction(e[r])&&t.on(r,e[r])}),s.on(r,{dragover:function(r){if(r.stopPropagation(),d){var a=s.create("overing",{overElm:r.target,transfer:c.draggingTransfer,acceptable:!0});t.trigger(a),a.acceptable&&(r.preventDefault(),r.dataTransfer.dropEffect="copyMove")}},dragenter:function(r){var a=(t._params,t.elm),e=s.create("entered",{transfer:c.draggingTransfer});t.trigger(e),r.stopPropagation(),n&&d&&i.addClass(a,n)},dragleave:function(r){var a=(t._params,t.elm);if(!d)return!1;var e=s.create("leaved",{transfer:c.draggingTransfer});t.trigger(e),r.stopPropagation(),n&&d&&i.removeClass(a,n)},drop:function(r){var a=(t._params,t.elm);if(s.stop(r),c.dragging){n&&d&&i.addClass(a,n);var e=s.create("dropped",{transfer:c.draggingTransfer});t.trigger(e),c.end(!0)}}}),c.on("started",function(a){var e=s.create("started",{transfer:c.draggingTransfer,acceptable:!1});t.trigger(e),d=e.acceptable,n=e.hoverClass,g=e.activeClass,g&&d&&i.addClass(r,g)}).on("ended",function(a){var e=s.create("ended",{transfer:c.draggingTransfer,acceptable:!1});t.trigger(e),n&&d&&i.removeClass(r,n),g&&d&&i.removeClass(r,g),d=!1,g=null,n=null})}});return a.mixin(l,{draggable:d,droppable:o,manager:c}),r.dnd=l});
//# sourceMappingURL=sourcemaps/dnd.js.map
