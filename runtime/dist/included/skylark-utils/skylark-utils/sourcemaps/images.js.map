{"version":3,"sources":["images.js"],"names":["define","skylark","langx","noder","geom","styler","datax","transforms","$","loaded","el","options","callback","inst","ImagesLoaded","d","Deferred","on","e","progress","resolve","images","reject","promise","viewer","onload","css","img","top","clientSize","height","offsetHeight","left","width","offsetWidth","reset","visibility","loadedCallback","onerror","_init","style","position","Image","border","padding","margin","append","url","_load","src","_dispose","remove","failered","ret","load","dispose","forEach","name","args","makeArray","arguments","unshift","apply","elementNodeTypes","1","9","11","Evented","inherit","init","elem","onAlways","document","querySelectorAll","this","elements","mixin","getImages","setTimeout","check","bind","addElementImages","nodeName","addImage","background","addElementBackgroundImages","nodeType","childImgs","i","length","children","child","getComputedStyle","reURL","matches","exec","backgroundImage","addBackground","loadingImage","LoadingImage","push","PreloadImage","onProgress","_this","progressedCount","hasAnyBroken","one","complete","isLoaded","trigger","createEvent","element","message","debug","console","log","target","eventName","isComplete","getIsImageComplete","confirm","naturalWidth","proxyImage","addEventListener","undefined","handleEvent","event","method","type","unbindEvents","removeEventListener","fn","imagesLoaded","transform"],"mappings":"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","file":"../images.js","sourcesContent":["define([\r\n    \"./skylark\",\r\n    \"./langx\",\r\n    \"./noder\",\r\n    \"./geom\",\r\n    \"./styler\",\r\n    \"./datax\",\r\n    \"./transforms\",\r\n    \"./query\"\r\n], function(skylark,langx,noder,geom,styler,datax,transforms,$) {\r\n\r\n  var elementNodeTypes = {\r\n    1: true,\r\n    9: true,\r\n    11: true\r\n  };\r\n\r\n  var ImagesLoaded = langx.Evented.inherit({\r\n   /**\r\n   * @param {Array, Element, NodeList, String} elem\r\n   * @param {Object or Function} options - if function, use as callback\r\n   * @param {Function} onAlways - callback function\r\n   */\r\n    init : function(elem, options, onAlways) {\r\n      // use elem as selector string\r\n      if ( typeof elem == 'string' ) {\r\n        elem = document.querySelectorAll( elem );\r\n      }\r\n\r\n      this.elements = langx.makeArray( elem );\r\n      this.options = langx.mixin( {}, this.options );\r\n\r\n      if ( typeof options == 'function' ) {\r\n        onAlways = options;\r\n      } else {\r\n        langx.mixin( this.options, options );\r\n      }\r\n\r\n      if ( onAlways ) {\r\n        this.on( 'always', onAlways );\r\n      }\r\n\r\n      this.getImages();\r\n\r\n     // HACK check async to allow time to bind listeners\r\n      setTimeout( function() {\r\n        this.check();\r\n      }.bind( this ));\r\n\r\n    },\r\n\r\n    options : {},\r\n\r\n    getImages : function() {\r\n      this.images = [];\r\n\r\n      // filter & find items if we have an item selector\r\n      this.elements.forEach( this.addElementImages, this );\r\n    },\r\n\r\n    /**\r\n     * @param {Node} element\r\n     */\r\n    addElementImages : function( elem ) {\r\n      // filter siblings\r\n      if ( elem.nodeName == 'IMG' ) {\r\n        this.addImage( elem );\r\n      }\r\n      // get background image on element\r\n      if ( this.options.background === true ) {\r\n        this.addElementBackgroundImages( elem );\r\n      }\r\n\r\n      // find children\r\n      // no non-element nodes, #143\r\n      var nodeType = elem.nodeType;\r\n      if ( !nodeType || !elementNodeTypes[ nodeType ] ) {\r\n        return;\r\n      }\r\n      var childImgs = elem.querySelectorAll('img');\r\n      // concat childElems to filterFound array\r\n      for ( var i=0; i < childImgs.length; i++ ) {\r\n        var img = childImgs[i];\r\n        this.addImage( img );\r\n      }\r\n\r\n      // get child background images\r\n      if ( typeof this.options.background == 'string' ) {\r\n        var children = elem.querySelectorAll( this.options.background );\r\n        for ( i=0; i < children.length; i++ ) {\r\n          var child = children[i];\r\n          this.addElementBackgroundImages( child );\r\n        }\r\n      }\r\n    },\r\n\r\n    addElementBackgroundImages : function( elem ) {\r\n      var style = getComputedStyle( elem );\r\n      if ( !style ) {\r\n        // Firefox returns null if in a hidden iframe https://bugzil.la/548397\r\n        return;\r\n      }\r\n      // get url inside url(\"...\")\r\n      var reURL = /url\\((['\"])?(.*?)\\1\\)/gi;\r\n      var matches = reURL.exec( style.backgroundImage );\r\n      while ( matches !== null ) {\r\n        var url = matches && matches[2];\r\n        if ( url ) {\r\n          this.addBackground( url, elem );\r\n        }\r\n        matches = reURL.exec( style.backgroundImage );\r\n      }\r\n    },\r\n\r\n    /**\r\n     * @param {Image} img\r\n     */\r\n    addImage : function( img ) {\r\n      var loadingImage = new LoadingImage( img );\r\n      this.images.push( loadingImage );\r\n    },\r\n\r\n    addBackground : function( url, elem ) {\r\n      var background = new PreloadImage( url, elem );\r\n      this.images.push( background );\r\n    },\r\n\r\n    check : function() {\r\n      var _this = this;\r\n      this.progressedCount = 0;\r\n      this.hasAnyBroken = false;\r\n      // complete if no images\r\n      if ( !this.images.length ) {\r\n        this.complete();\r\n        return;\r\n      }\r\n\r\n      function onProgress( e ) {\r\n        // HACK - Chrome triggers event before object properties have changed. #83\r\n        setTimeout( function() {\r\n          _this.progress( e );\r\n        });\r\n      }\r\n\r\n      this.images.forEach( function( loadingImage ) {\r\n        loadingImage.one( 'progress', onProgress );\r\n        loadingImage.check();\r\n      });\r\n    },\r\n\r\n    progress : function( e ) {\r\n\r\n      this.progressedCount++;\r\n      this.hasAnyBroken = this.hasAnyBroken || !e.isLoaded;\r\n      // progress event\r\n      this.trigger( langx.createEvent('progress', {\r\n        img : e.img,\r\n        element : e.element,\r\n        message : e.message,\r\n        isLoaded : e.isLoaded\r\n      }));\r\n\r\n      // check if completed\r\n      if ( this.progressedCount == this.images.length ) {\r\n        this.complete();\r\n      }\r\n\r\n      if ( this.options.debug && console ) {\r\n        console.log( 'progress: ' + message, e.target, e.element );\r\n      }\r\n    },\r\n\r\n    complete : function() {\r\n      var eventName = this.hasAnyBroken ? 'fail' : 'done';\r\n      this.isComplete = true;\r\n      this.trigger(langx.createEvent(eventName,{\r\n        images : this.images\r\n      }));\r\n    }\r\n\r\n  });\r\n \r\n\r\n  // --------------------------  -------------------------- //\r\n\r\n  var LoadingImage = langx.Evented.inherit({\r\n    init: function( img ) {\r\n      this.img = img;\r\n    },\r\n    check : function() {\r\n      // If complete is true and browser supports natural sizes,\r\n      // try to check for image status manually.\r\n      var isComplete = this.getIsImageComplete();\r\n      if ( isComplete ) {\r\n        // report based on naturalWidth\r\n        this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n        return;\r\n      }\r\n\r\n      // If none of the checks above matched, simulate loading on detached element.\r\n      this.proxyImage = new Image();\r\n      this.proxyImage.addEventListener( 'load', this );\r\n      this.proxyImage.addEventListener( 'error', this );\r\n      // bind to image as well for Firefox. #191\r\n      this.img.addEventListener( 'load', this );\r\n      this.img.addEventListener( 'error', this );\r\n      this.proxyImage.src = this.img.src;\r\n    },\r\n\r\n    getIsImageComplete : function() {\r\n      return this.img.complete && this.img.naturalWidth !== undefined;\r\n    },\r\n\r\n    confirm : function( isLoaded, message ) {\r\n      this.isLoaded = isLoaded;\r\n      this.trigger( langx.createEvent('progress', {\r\n        img : this.img, \r\n        element : this.img,\r\n        message : message ,\r\n        isLoaded : isLoaded\r\n      }));\r\n    },\r\n // ----- events ----- //\r\n    // trigger specified handler for event type\r\n    handleEvent : function( event ) {\r\n      var method = 'on' + event.type;\r\n      if ( this[ method ] ) {\r\n        this[ method ]( event );\r\n      }\r\n    },\r\n\r\n    onload : function() {\r\n      this.confirm( true, 'onload' );\r\n      this.unbindEvents();\r\n    },\r\n\r\n    onerror : function() {\r\n      this.confirm( false, 'onerror' );\r\n      this.unbindEvents();\r\n    },\r\n\r\n    unbindEvents : function() {\r\n      this.proxyImage.removeEventListener( 'load', this );\r\n      this.proxyImage.removeEventListener( 'error', this );\r\n      this.img.removeEventListener( 'load', this );\r\n      this.img.removeEventListener( 'error', this );\r\n    },\r\n\r\n  });\r\n\r\n\r\n  // -------------------------- PreloadImage -------------------------- //\r\n  var PreloadImage = LoadingImage.inherit({\r\n\r\n    init : function( url, element ) {\r\n      this.url = url;\r\n      this.element = element;\r\n      this.img = new Image();\r\n    },\r\n\r\n    check : function() {\r\n      this.img.addEventListener( 'load', this );\r\n      this.img.addEventListener( 'error', this );\r\n      this.img.src = this.url;\r\n      // check if image is already complete\r\n      var isComplete = this.getIsImageComplete();\r\n      if ( isComplete ) {\r\n        this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n        this.unbindEvents();\r\n      }\r\n    },\r\n\r\n    unbindEvents : function() {\r\n      this.img.removeEventListener( 'load', this );\r\n      this.img.removeEventListener( 'error', this );\r\n    },\r\n\r\n    confirm : function( isLoaded, message ) {\r\n      this.isLoaded = isLoaded;\r\n      this.trigger( langx.createEvent('progress', {\r\n        img : this.img,\r\n        element : this.element, \r\n        message : message,\r\n        isLoaded : isLoaded \r\n      }));\r\n    }\r\n  });\r\n\r\n  function loaded(el,options, callback ) {\r\n      var inst = new ImagesLoaded( el, options, callback );\r\n\r\n      var d = new langx.Deferred();\r\n      \r\n      inst.on(\"progress\",function(e){\r\n        d.progress(e);\r\n      });\r\n\r\n      inst.on(\"done\",function(e){\r\n        d.resolve(e.images);\r\n      });\r\n\r\n      inst.on(\"fail\",function(e){\r\n        d.reject(e);\r\n      });\r\n\r\n      return d.promise;\r\n  }\r\n\r\n  function preload(urls,options) {\r\n\r\n  }\r\n\r\n  $.fn.imagesLoaded = function( options, callback ) {\r\n      return loaded(this,options,callback);\r\n  };\r\n\r\n\r\n  function viewer(el,options) {\r\n    var img ,\r\n        style = {},\r\n        clientSize = geom.clientSize(el),\r\n        loadedCallback = options.loaded,\r\n        faileredCallback = options.failered;\r\n\r\n    function onload() {\r\n        styler.css(img,{//居中\r\n          top: (clientSize.height - img.offsetHeight) / 2 + \"px\",\r\n          left: (clientSize.width - img.offsetWidth) / 2 + \"px\"\r\n        });\r\n\r\n        transforms.reset(img);\r\n\r\n        styler.css(img,{\r\n          visibility: \"visible\"\r\n        });\r\n\r\n        if (loadedCallback) {\r\n          loadedCallback();\r\n        }\r\n    }\r\n\r\n    function onerror() {\r\n\r\n    }\r\n    function _init() {\r\n      style = styler.css(el,[\"position\",\"overflow\"]);\r\n      if (style.position != \"relative\" && style.position != \"absolute\") { \r\n        styler.css(el,\"position\", \"relative\" );\r\n      }\r\n      styler.css(el,\"overflow\", \"hidden\" );\r\n\r\n      img = new Image();\r\n\r\n      styler.css(img,{\r\n        position: \"absolute\",\r\n        border: 0, padding: 0, margin: 0, width: \"auto\", height: \"auto\",\r\n        visibility: \"hidden\"\r\n      });\r\n\r\n      img.onload = onload;\r\n      img.onerror = onerror;\r\n\r\n      noder.append(el,img);\r\n\r\n      if (options.url) {\r\n        _load(options.url);\r\n      }\r\n    }\r\n\r\n    function _load(url) {\r\n        img.style.visibility = \"hidden\";\r\n        img.src = url;\r\n    }\r\n\r\n    function _dispose() {\r\n        noder.remove(img);\r\n        styler.css(el,style);\r\n        img = img.onload = img.onerror = null;\r\n    }\r\n\r\n    _init();\r\n\r\n    var ret =  {\r\n      load : _load,\r\n      dispose : _dispose\r\n    };\r\n\r\n    [\"vertical\",\"horizontal\",\"rotate\",\"left\",\"right\",\"scale\",\"zoom\",\"zoomin\",\"zoomout\",\"reset\"].forEach(\r\n      function(name){\r\n        ret[name] = function() {\r\n          var args = langx.makeArray(arguments);\r\n          args.unshift(img);\r\n          transforms[name].apply(null,args);\r\n        }\r\n      }\r\n    );\r\n\r\n    return ret;\r\n  }\r\n\r\n\r\n  function images() {\r\n    return images;\r\n  }\r\n\r\n  images.transform = function (el,options) {\r\n  };\r\n\r\n  [\"vertical\",\"horizontal\",\"rotate\",\"left\",\"right\",\"scale\",\"zoom\",\"zoomin\",\"zoomout\",\"reset\"].forEach(\r\n    function(name){\r\n      images.transform[name] = transforms[name];\r\n    }\r\n  );\r\n\r\n\r\n  langx.mixin(images, {\r\n    loaded : loaded,\r\n\r\n    viewer : viewer\r\n  });\r\n\r\n  return skylark.images = images;\r\n});\r\n"]}