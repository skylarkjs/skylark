/**
 * skylark-spa - An Elegant  HTML5 Single Page Application Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.3-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,r){function e(t,r){if("."!==t[0])return t;var e=r.split("/"),n=t.split("/");e.pop();for(var i=0;i<n.length;i++)"."!=n[i]&&(".."==n[i]?e.pop():e.push(n[i]));return e.join("/")}var n=r.define,i=r.require,o="function"==typeof n&&n.amd,a=!o&&"undefined"!=typeof exports;if(!o&&!n){var s={};n=r.define=function(t,r,n){"function"==typeof n?(s[t]={factory:n,deps:r.map(function(r){return e(r,t)}),exports:null},i(t)):resolved[t]=n},i=r.require=function(t){if(!s.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var r=s[t];if(!r.exports){var e=[];r.deps.forEach(function(t){e.push(i(t))}),r.exports=r.factory.apply(window,e)}return r.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(n,i),o)n(["skylark-spa"],function(t){return t});else{var u=i("skylark-spa/main");a?exports=u:r.skylarkjs=u}}(function(t,r){t("skylark-spa/spa",["skylark-langx/skylark","skylark-langx/langx","skylark-router/router"],function(t,e,n){function i(t,r){var n=new CustomEvent(t,r);return e.safeMixin(n,r)}var o,a=e.Deferred,s=n.Route=n.Route.inherit({klassName:"SpaRoute",init:function(t,r){this.overrided(t,r),this.content=r.content,this.data=r.data;var n=this;["preparing","rendering","rendered"].forEach(function(t){e.isFunction(r[t])&&n.on(t,r[t])})},_entering:function(t){return this._prepared?this:this.prepare()},getConfigData:function(t){return t?this.data[t]:this.data},getNamedValue:function(){return window.location.pathname.match(this.regex)},prepare:function(){var t=new a,e=this._setting,n=e.controller,o=this.controller,s=this;e.content,e.contentPath;return r([n.type],function(r){o=s.controller=new r(n),t.resolve()}),t.then(function(){var t=i("preparing",{route:s,result:!0});return s.trigger(t),a.when(t.result).then(function(){s._prepared=!0})})},render:function(t){var r=i("rendering",{route:this,context:t,content:this.content});return this.trigger(r),r.content},trigger:function(t){var r=this.controller;return r?r.perform(t):this.overrided(t)}}),u=e.Evented.inherit({klassName:"SpaRouteController",init:function(t,r){r=r||{},this.content=r.content,this.data=r.data},getConfigData:function(t){return t?this.data[t]:this.data},perform:function(t){var r=t.type;if(this[r])return this[r].call(this,t)}}),p=e.Evented.inherit({klassName:"SpaPage",init:function(t){t=e.mixin({routeViewer:"body"},t),this._params=t,this._rvc=document.querySelector(t.routeViewer),this._router=n,n.on("routed",e.proxy(this,"refresh"))},prepare:function(){},refresh:function(){var t=n.current(),r=(n.previous(),t.route.render(t));e.isString(r)?this._rvc.innerHTML=r:(this._rvc.innerHTML="",this._rvc.appendChild(r)),t.route.trigger(i("rendered",{route:t.route,content:r}))}}),h=e.Evented.inherit({klassName:"SpaPlugin",init:function(t,r){this.name=t,e.isString(r.hookers)&&(r.hookers=r.hookers.split(" ")),this._setting=r},isHooked:function(t){var r=this._setting.hookers||[];return r.indexOf(t)>-1},prepare:function(){var t=new a,o=this._setting,s=o.controller,u=this.controller,p=this;return r([s.type],function(r){u=p.controller=new r(s),n.on(o.hookers,{plugin:p},e.proxy(u.perform,u)),t.resolve()}),t.then(function(){var t=i("preparing",{plugin:p,result:!0});return p.trigger(t),a.when(t.result).then(function(){p._prepared=!0})})},trigger:function(t){var r=this.controller;return r?r.perform(t):this.overrided(t)}}),l=e.Evented.inherit({klassName:"SpaPluginController",init:function(t){this.plugin=t},perform:function(t){var r=t.type;if(this[r])return this[r].call(this,t)}}),c=e.Evented.inherit({klassName:"SpaApplication",init:function(t){if(o)return o;var r=this._plugins={};t=this._config=e.mixin({plugins:{}},t,!0),e.each(t.plugins,function(t,e){r[t]=new h(t,e)}),n.routes(t.routes),this._router=n,this._page=new f.Page(t.page),document.title=t.title;var i=t.baseUrl;void 0===i&&(i=t.baseUrl=new e.URL(document.baseURI).pathname),n.baseUrl(i),t.homePath&&n.homePath(t.homePath),o=this},getConfig:function(t){return t?this._config[t]:this._config},go:function(t,r){return n.go(t,r),this},page:function(){return this._page},prepare:function(){if(this._prepared)return a.resolve();var t=this,r=e.map(this._plugins,function(t,r){if(t.isHooked("starting"))return t.prepare()});return a.all(r).then(function(){n.trigger(i("starting",{spa:t}));var r=e.map(n.routes(),function(t,r){if(t.lazy===!1)return t.prepare()}),o=e.map(t._plugins,function(t,r){if(!t.isHooked("starting"))return t.prepare()});return a.all(r.concat(o)).then(function(){t._prepared=!0})})},run:function(){this._router.start(),n.trigger(i("started",{spa:this}))}}),f=function(t){return o||(window[t.name||"app"]=o=new f.Application(t)),o};return e.mixin(f,{Application:c,Page:p,Plugin:h,PluginController:l,Route:s,RouteController:u}),t.spa=f}),t("skylark-spa/main",["skylark-langx/skylark","./spa"],function(t){return t}),t("skylark-spa",["skylark-spa/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-spa.js.map
